<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="QSnowy">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="QSnowy">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="QSnowy">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>QSnowy</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">QSnowy</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">代码会说话</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/26/%E4%BD%BF%E7%94%A8hexo%E6%90%AD%E5%BB%BAGithubPage%E5%8D%9A%E5%AE%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/26/%E4%BD%BF%E7%94%A8hexo%E6%90%AD%E5%BB%BAGithubPage%E5%8D%9A%E5%AE%A2/" class="post-title-link" itemprop="url">使用hexo搭建GithubPage博客</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-26 08:19:50 / 修改时间：05:59:05" itemprop="dateCreated datePublished" datetime="2020-04-26T08:19:50+00:00">2020-04-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo</a>是一个基于<a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a>的高效静态网站生成框架，使你可以专注于MarkDown文档内容的编写，其他的网站资源生成交给Hexo就行了。我主要讲一讲自己是如何在Mac上面使用Hexo编写博客的。</p>
<h3 id="创建博客"><a href="#创建博客" class="headerlink" title="创建博客"></a>创建博客</h3><p>首先你得安装<a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a>和<a href="https://git-scm.com/" target="_blank" rel="noopener">Git</a>，不过Mac里面默认自带Git的，不用重复安装了。Node环境，这里我用的是<a href="https://brew.sh/index_zh-cn" target="_blank" rel="noopener">Homebrew</a>安装的</p>
<p>直接终端里输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install node</span><br></pre></td></tr></table></figure>

<p>安装Hexo</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo</span><br></pre></td></tr></table></figure>

<p>本地创建博客目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init &lt;blog directory&gt;</span><br></pre></td></tr></table></figure>

<p>进入博客目录，运行启动服务器命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo serve</span><br><span class="line">// 也可以简写为 hexo s</span><br></pre></td></tr></table></figure>

<p>之后终端会输出以下信息</p>
<blockquote>
<p> INFO  Start processing<br> INFO  Hexo is running at <a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a> . Press Ctrl+C to stop.</p>
</blockquote>
<p>表明博客已经运行在<a href="http://localhost:4000" target="_blank" rel="noopener">本地</a>了，浏览器打开网址就能看到效果，是不是很简单。</p>
<h3 id="部署博客到GithubPages"><a href="#部署博客到GithubPages" class="headerlink" title="部署博客到GithubPages"></a>部署博客到GithubPages</h3><p>下面我们就要把自己的博客部署到<a href="https://github.com" target="_blank" rel="noopener">GitHubPages</a>，首先你得有个GitHub交友账号，这里默认各位已经有了。我们去GitHub上面创建一个repository，名字要这个样式的：<code>&lt;yourname&gt;.github.io</code>，因为GitHubPages会默认读取这个名字的仓库。</p>
<p>安装部署git的插件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>设置一下站点配置文件<code>_config.yml</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: 'your repository address' # 自己的GitHub仓库地址</span><br><span class="line">  branch: master # 指定一下 要放部署博客的分支</span><br></pre></td></tr></table></figure>

<p>一键部署</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br><span class="line">// 可以简写为 hexo d</span><br></pre></td></tr></table></figure>

<p>等几分钟，去浏览器打开 <code>&lt;yourname&gt;.github.io</code> 就能看到自己的博客了。</p>
<h3 id="利用Travis自动部署"><a href="#利用Travis自动部署" class="headerlink" title="利用Travis自动部署"></a>利用Travis自动部署</h3><p>还想更简单吗，只用push文章到GitHub，然后自动部署到GitHubPages？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/05/2019%E5%85%A5%E6%88%B7%E5%B9%BF%E5%B7%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/05/2019%E5%85%A5%E6%88%B7%E5%B9%BF%E5%B7%9E/" class="post-title-link" itemprop="url">2019广州学历入户亲身经历</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-05 00:00:00" itemprop="dateCreated datePublished" datetime="2019-07-05T00:00:00+00:00">2019-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 05:59:04" itemprop="dateModified" datetime="2020-04-26T05:59:04+00:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB%E7%90%90%E4%BA%8B/" itemprop="url" rel="index"><span itemprop="name">生活琐事</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>昨天把入户材料递交给人才港，算是迈出入户流程一小步。虽然还没有真正拿到广州户口，但是我觉得有必要先分享一下自己的经验，毕竟我也是从网上查了很多资料踩了很多坑。<br>由于我办理的学历引进，所以我这里就只说一下学历引进的流程。</p>
<h3 id="入户流程"><a href="#入户流程" class="headerlink" title="入户流程"></a>入户流程</h3><p>先到<a href="https://www.gdzwfw.gov.cn/" target="_blank" rel="noopener">广东政务网</a>搜一下最新的<code>人才引进</code>政策，会看到相应的办理指南，顺便说一下广东的政府网站还是挺有用的。整个流程就如下图一样<br><img src="../assets/images/%E4%BA%BA%E6%89%8D%E5%BC%95%E8%BF%9B%E6%B5%81%E7%A8%8B.png" alt=""></p>
<h3 id="材料准备"><a href="#材料准备" class="headerlink" title="材料准备"></a>材料准备</h3><p>在政府网站看到的指南中，会明确说明需要准备哪些材料，下面我列一个具体的清单：</p>
<ul>
<li>广州市引进人才申报表，这个表需要在<a href="http://gzrsj.hrssgz.gov.cn/vsgzhr/PersonalPortal/home.aspx?TOKENID=L0U1b2N2aEtuMFlEaWRlUldxUEVpUT09&RESID=null" target="_blank" rel="noopener">智慧人才家园</a>填写资料(这个网址我搜了大半天才找到😅)，上传相应的图片附件。然后打印一份(一份就够了)，交给单位签字盖章。记得签字哟，审核人员看我的文件只有公章，当场让我用另一种手法写上同意和年月日😂</li>
<li>户口簿户主页和本人页，这个复印一份，盖上单位公章。</li>
<li>落户地址材料，由于本人广州没房，提供了一份《落户公共集体户申请书》，模板网上有，打印下来，自己签字按指模就行了不需要单位盖章。这里要多说一句，单位地址所属街道，上<a href="https://lbs.amap.com/api/javascript-api/example/geocoder/regeocoding" target="_blank" rel="noopener">高德地图API</a>查一下就出来了。</li>
<li>毕业证复印件及学信网认证证书，去<a href="https://my.chsi.com.cn/archive/bab/index.action" target="_blank" rel="noopener">学信网</a>打印认证证书，需要单位盖章。</li>
<li>学位证复印件及学历认证证书，在<a href="https://www.chinadegrees.cn/cqva/personal/index.html" target="_blank" rel="noopener">学历网</a>打印学历认证证书，需要单位盖章。</li>
</ul>
<p>我是广州参加的社保，所以不用准备社保缴费历史明细。如果不是的话，需要提供省参保历史缴费明细的。<br>把上面的材料准备齐全，然后去<a href="http://www.thnet.gov.cn/thxxw/zwe_lcfb/zwe_nry.shtml" target="_blank" rel="noopener">天河政务</a>预约，话说这个预约挺难的，每个工作日9点放号，需要蹲点抢号。</p>
<h3 id="入户材料递交"><a href="#入户材料递交" class="headerlink" title="入户材料递交"></a>入户材料递交</h3><p>这个就没什么可说的，带上<code>申报表</code>、<code>户口簿原件和复印件</code>、<code>落户地址材料</code>、<code>毕业证原件和复印件</code>、<code>学位证原件和复印件</code>、<code>学历认证证书</code>、<code>学位认证证书</code>，去现场取号办理就行了，其实这一步就是人工复核资料是否属实，现场会给一堆文件签字确认的。</p>
<h3 id="户口迁移"><a href="#户口迁移" class="headerlink" title="户口迁移"></a>户口迁移</h3><p>入户资料递交后，大约一个月后就会有批复结果了，等待期间可以到广州人社局网站<a href="http://gzrsj.hrssgz.gov.cn/vsgzpiapp01/GZPI/Gateway/PersonIntroducePublicity.aspx" target="_blank" rel="noopener">人才引进公示名单</a>里查看自己是否通过审核。</p>
<p>看到自己在公示名单中，公示一周后就会收到人社局的批复文件和人才卡。如果是广东省内户籍，直接去广州的公安户政窗口办理手续就可以。如果是省外户籍的话，需要自己(可以找人代办)拿着户口准迁证，先回老家办理户口迁出，然后拿着老家的<code>户口迁出证</code>、<code>身份证</code>、<code>准迁证</code>、<code>公司营业执照副本</code>、<code>人才卡</code>到广州这边户政窗口办理迁入手续。同样也是要在<a href="http://www.thnet.gov.cn/thxxw/zwe_lcfb/zwe_nry.shtml" target="_blank" rel="noopener">天河政务</a>上面预约的。</p>
<p>办理广州入户后，可以直接在户政窗口申领新身份证，旧身份证可以自己保留。现场出本人户口本页，由于迁入的是街道集体户，本人页不能保管只能自己先拍照记录一下。</p>
<p>至此，入户广州的流程算是办完了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/07/sdwebimage-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/07/sdwebimage-structure/" class="post-title-link" itemprop="url">SDWebImage代码解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-07 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-07T00:00:00+00:00">2019-03-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 05:59:05" itemprop="dateModified" datetime="2020-04-26T05:59:05+00:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>SDWebImage是GitHub上面一个很火的iOS和MacOS平台下，图片下载、加载、管理开发第三方库。</p>
<p>整个源码大概分为：图片管理、下载器、下载任务、缓存、编码解码、UI展示几个模块。</p>
<ul>
<li>图片管理：SDWebImageManager</li>
<li>下载器：SDWebImageDownloader</li>
<li>下载任务：SDWebImageDownloaderOperation</li>
<li>缓存：SDWebImageCache</li>
<li>解码：SDWebImageIOCoder、SDWebImageGIFCoder</li>
<li>UI展示：UIImageView+WebCache 等</li>
<li>配置其他：SDImageCacheConfig等</li>
</ul>
<p><strong>先说一下，整体的图片下载流程：</strong><br>给定一个URL给<code>Manager</code>后，会先用<code>Cache</code>检测是否有对应的缓存图片，如果没有缓存且需要下载，<code>Manager</code>持有的<code>Downloader</code>会生成一个<code>URLSession</code>，将<code>URL</code>转化为一个<code>Request</code>，然后把<code>Request</code>和<code>URLSession</code>包装在<code>Operation</code>中，将<code>Operation</code>加入到自己的<code>下载队列</code>中，开始执行下载任务；任务完成或者异常，经过<code>系统的Request代理</code>回调，拿到图片数据或异常，通过<code>Coder</code>将数据解压为图片，利用<code>Cache</code>缓存在内存和磁盘中，通过<code>block回调</code>给到主线程进行处理。</p>
<h3 id="图片管理"><a href="#图片管理" class="headerlink" title="图片管理"></a>图片管理</h3><p>采用单例模式，初始化后默认会持有<code>SDWebImageCache</code>和<code>SDWebImageDownloader</code>两个实例，便于进行图片缓存和下载管理。不过用户也可以通过下面的方法自行指定</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (nonnull instancetype)initWithCache:(nonnull <span class="type">SDImageCache</span> *)cache downloader:(nonnull <span class="type">SDWebImageDownloader</span> *)downloader</span><br></pre></td></tr></table></figure>
<p>同时提供代理方法，为用户提供URL过滤功能，需要自己实现代理方法。</p>
<h4 id="常用方法："><a href="#常用方法：" class="headerlink" title="常用方法："></a>常用方法：</h4><p>使用Mananger下载指定URL图片，监听下载进度，完成回调，返回一个可取消的下载任务。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (nullable id &lt;<span class="type">SDWebImageOperation</span>&gt;)loadImageWithURL:(nullable <span class="type">NSURL</span> *)url</span><br><span class="line">                                              options:(<span class="type">SDWebImageOptions</span>)options</span><br><span class="line">                                             progress:(nullable <span class="type">SDWebImageDownloaderProgressBlock</span>)progressBlock</span><br><span class="line">                                            completed:(nullable <span class="type">SDInternalCompletionBlock</span>)completedBlock;</span><br></pre></td></tr></table></figure>

<h3 id="下载器"><a href="#下载器" class="headerlink" title="下载器"></a>下载器</h3><p>采用单例模式，用户可以指定URLSessionConfiguration，所有URL请求都会使用这一个session配置。</p>
<h4 id="常用方法：-1"><a href="#常用方法：-1" class="headerlink" title="常用方法："></a>常用方法：</h4><p>指定session配置</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (nonnull instancetype)initWithSessionConfiguration:(nullable <span class="type">NSURLSessionConfiguration</span> *)sessionConfiguration</span><br></pre></td></tr></table></figure>
<p>开始一个URL下载请求，监听进度，完成回调，返回一个下载Token，用户可以使用这个Token取消下载。一个URL会产生一个Operation，加入下载队列，进行网络请求。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (nullable <span class="type">SDWebImageDownloadToken</span> *)downloadImageWithURL:(nullable <span class="type">NSURL</span> *)url</span><br><span class="line">                                                   options:(<span class="type">SDWebImageDownloaderOptions</span>)options</span><br><span class="line">                                                  progress:(nullable <span class="type">SDWebImageDownloaderProgressBlock</span>)progressBlock</span><br><span class="line">                                                 completed:(nullable <span class="type">SDWebImageDownloaderCompletedBlock</span>)completedBlock</span><br></pre></td></tr></table></figure>

<p>取消一个下载任务</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)cancel:(nullable <span class="type">SDWebImageDownloadToken</span> *)token</span><br></pre></td></tr></table></figure>

<h3 id="下载任务"><a href="#下载任务" class="headerlink" title="下载任务"></a>下载任务</h3><p>这里面定义了一个任务可交互的协议，<code>SDWebImageDownloaderOperationInterface</code>，协议规定了任务的初始化方法、添加任务进度和完成的回调的方法、任务的取消方法以及证书的添加。任务继承与NSOperation，一个请求对应了一个任务，这些任务会放在下载管理单例中的一个下载队列中，可以按先入先出的顺序执行，也可以按堆栈的后入先出的顺序执行。</p>
<p>任务在收到请求回应后，会将接受到的图片数据解码成为UIImage对象，再通过Block进行回调给主线程。</p>
<h4 id="常用方法：-2"><a href="#常用方法：-2" class="headerlink" title="常用方法："></a>常用方法：</h4><p>初始化一个任务，这是一个实现的协议方法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (nonnull instancetype)initWithRequest:(nullable <span class="type">NSURLRequest</span> *)request</span><br><span class="line">                              inSession:(nullable <span class="type">NSURLSession</span> *)session</span><br><span class="line">                                options:(<span class="type">SDWebImageDownloaderOptions</span>)options</span><br></pre></td></tr></table></figure>
<p>添加任务进度回调</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (nullable id)addHandlersForProgress:(nullable <span class="type">SDWebImageDownloaderProgressBlock</span>)progressBlock</span><br><span class="line">                            completed:(nullable <span class="type">SDWebImageDownloaderCompletedBlock</span>)completedBlock</span><br></pre></td></tr></table></figure>

<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>通过这个模块，将下载完成的图片，存储到内存或者磁盘中。同样是单例模式，用户可以指定缓存路径。使用了<code>SDMemoryCache:NSCache</code>进行内存存储，内部使用了<code>NSMapTable&lt;KeyType, ObjectType&gt; *weakCache</code>这个属性进行实际的内存存储工作。</p>
<h4 id="常用方法：-3"><a href="#常用方法：-3" class="headerlink" title="常用方法："></a>常用方法：</h4><p>指定缓存路径</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (nonnull instancetype)initWithNamespace:(nonnull <span class="type">NSString</span> *)ns</span><br><span class="line">                       diskCacheDirectory:(nonnull <span class="type">NSString</span> *)directory</span><br></pre></td></tr></table></figure>
<p>存储图片到内存或者磁盘，图片通过编码工具转为二进制数据，最终存储在磁盘中。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)storeImage:(nullable <span class="type">UIImage</span> *)image</span><br><span class="line">         imageData:(nullable <span class="type">NSData</span> *)imageData</span><br><span class="line">            forKey:(nullable <span class="type">NSString</span> *)key</span><br><span class="line">            toDisk:(<span class="type">BOOL</span>)toDisk</span><br><span class="line">        completion:(nullable <span class="type">SDWebImageNoParamsBlock</span>)completionBlock</span><br></pre></td></tr></table></figure>
<p>从内存或者磁盘中找到与key对应的图片</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (nullable <span class="type">UIImage</span> *)imageFromCacheForKey:(nullable <span class="type">NSString</span> *)key;</span><br></pre></td></tr></table></figure>

<p>清除内存和磁盘缓存</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)clearMemory;</span><br><span class="line">- (void)clearDiskOnCompletion:(nullable <span class="type">SDWebImageNoParamsBlock</span>)completion;</span><br></pre></td></tr></table></figure>

<h3 id="编码解码"><a href="#编码解码" class="headerlink" title="编码解码"></a>编码解码</h3><p>框架中有IOCoder和GIFCoder，我这里只展示IOCoder，下载完的图片会通过转化为NSData，同时从网络获取的数据也会被解码转化为image。</p>
<h4 id="关键方法："><a href="#关键方法：" class="headerlink" title="关键方法："></a>关键方法：</h4><p>将图片根据不同的图片格式，转化为二进制数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">NSData</span> *)encodedDataWithImage:(<span class="type">UIImage</span> *)image format:(<span class="type">SDImageFormat</span>)format&#123;</span><br><span class="line">    <span class="comment">// 判断图片格式，最后会保存为PNG或者JPEG格式，这里省略了一些源码</span></span><br><span class="line">    <span class="type">NSMutableData</span> *imageData = [<span class="type">NSMutableData</span> data];</span><br><span class="line">    <span class="type">CFStringRef</span> imageUTType = [<span class="type">NSData</span> sd_UTTypeFromSDImageFormat:format];</span><br><span class="line">    <span class="comment">// 创建 image destination.</span></span><br><span class="line">    <span class="type">CGImageDestinationRef</span> imageDestination = <span class="type">CGImageDestinationCreateWithData</span>((__bridge <span class="type">CFMutableDataRef</span>)imageData, imageUTType, <span class="number">1</span>, <span class="type">NULL</span>);</span><br><span class="line">    <span class="comment">// 设置图片方向信息</span></span><br><span class="line">    <span class="type">NSMutableDictionary</span> *properties = [<span class="type">NSMutableDictionary</span> dictionary];</span><br><span class="line">    <span class="type">NSInteger</span> exifOrientation = [<span class="type">SDWebImageCoderHelper</span> exifOrientationFromImageOrientation:image.imageOrientation];</span><br><span class="line">    [properties setValue:@(exifOrientation) forKey:(__bridge <span class="type">NSString</span> *)kCGImagePropertyOrientation];</span><br><span class="line">    <span class="comment">// 添加图片 to the destination.</span></span><br><span class="line">    <span class="type">CGImageDestinationAddImage</span>(imageDestination, image.<span class="type">CGImage</span>, (__bridge <span class="type">CFDictionaryRef</span>)properties);</span><br><span class="line">    <span class="comment">// 完成，将图片写入数据.</span></span><br><span class="line">    <span class="type">CGImageDestinationFinalize</span>(imageDestination);    </span><br><span class="line">    <span class="keyword">return</span> [imageData copy];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将图片解码，只是简单调用了系统接口。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">UIImage</span> *)decodedImageWithData:(<span class="type">NSData</span> *)data&#123;</span><br><span class="line">       <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">UIImage</span> *image = [[<span class="type">UIImage</span> alloc] initWithData:data];</span><br><span class="line">    image.sd_imageFormat = [<span class="type">NSData</span> sd_imageFormatForImageData:data];</span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>渐进式解析图片，主要用到了<code>CGImageSourceCreateIncremental</code>函数处理。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">UIImage</span> *)incrementallyDecodedImageWithData:(<span class="type">NSData</span> *)data finished:(<span class="type">BOOL</span>)finished &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_imageSource) &#123;</span><br><span class="line">        <span class="comment">// 创建渐进式ImageSource</span></span><br><span class="line">        _imageSource = <span class="type">CGImageSourceCreateIncremental</span>(<span class="type">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">UIImage</span> *image;</span><br><span class="line">    <span class="comment">// 将累积的数据传进来，不一定是完整的</span></span><br><span class="line">    <span class="type">CGImageSourceUpdateData</span>(_imageSource, (__bridge <span class="type">CFDataRef</span>)data, finished);</span><br><span class="line">    <span class="keyword">if</span> (_width + _height == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取source信息，从信息中拿到图片的宽、高、方向信息，省略了代码 </span></span><br><span class="line">        <span class="type">CFDictionaryRef</span> properties = <span class="type">CGImageSourceCopyPropertiesAtIndex</span>(_imageSource, <span class="number">0</span>, <span class="type">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_width + _height &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 拿到了有效信息，开始创建图片</span></span><br><span class="line">        <span class="type">CGImageRef</span> partialImageRef = <span class="type">CGImageSourceCreateImageAtIndex</span>(_imageSource, <span class="number">0</span>, <span class="type">NULL</span>);</span><br><span class="line">        <span class="keyword">if</span> (partialImageRef) &#123;</span><br><span class="line">            image = [[<span class="type">UIImage</span> alloc] initWithCGImage:partialImageRef scale:<span class="number">1</span> orientation:_orientation];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果传入了结束标志，说明当前图片的数据下载完了，返回生成好的image</span></span><br><span class="line">    <span class="keyword">if</span> (finished) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_imageSource) &#123;</span><br><span class="line">            <span class="type">CFRelease</span>(_imageSource);</span><br><span class="line">            _imageSource = <span class="type">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解压缩图片，主要用<code>CGBitmapContextCreate</code>创建位图。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该函数接收参数有data、width、height、bitsPerComponent、bytesPerRow、space、bitmapInfo</span></span><br><span class="line"><span class="comment">// data 如果不为NULL，那么它应该指向一块大小至少为 bytesPerRow * height 字节的内存；如果为NULL，那么系统就会为我们自动分配和释放所需的内存，所以一般指定NULL即可；</span></span><br><span class="line"><span class="comment">// width height 位图要输出的宽度和高度，宽高方面有多少颗pixel；</span></span><br><span class="line"><span class="comment">// bitsPerComponent 一个像素中每个独立的颜色分量使用的bit数，一个像素由RGB三色组合，这个参数代表R、G、B每个分量使用几个bit；</span></span><br><span class="line"><span class="comment">// bytesPerRow 每一行使用的字节数，设为0，系统会自动优化，自行设定大小至少为 width * bytes per pixel字节，bytesPerPixel是每颗像素需要多长字节去存储；</span></span><br><span class="line"><span class="comment">// space 颜色空间，常用的有&lt;RGB、CMYK、BGR、HSB&gt;，不同的空间对相同的数值有不同的解析方式，最终得到的图片色彩也不一样；</span></span><br><span class="line"><span class="comment">// bitmapInfo alpha信息表示alpha在像素中排在哪个位置、颜色分量是否浮点、像素格式的字节顺序；iOS使用小端字节序；</span></span><br><span class="line"><span class="type">CG_EXTERN</span> <span class="type">CGContextRef</span> __nullable <span class="type">CGBitmapContextCreate</span>(void * __nullable data,</span><br><span class="line">    size_t width, size_t height, size_t bitsPerComponent, size_t bytesPerRow,</span><br><span class="line">    <span class="type">CGColorSpaceRef</span> cg_nullable space, uint32_t bitmapInfo)</span><br><span class="line">    <span class="type">CG_AVAILABLE_STARTING</span>(__MAC_10_0, __IPHONE_2_0);</span><br><span class="line"></span><br><span class="line">- (nullable <span class="type">UIImage</span> *)sd_decompressedImageWithImage:(nullable <span class="type">UIImage</span> *)image &#123;</span><br><span class="line">    @autoreleasepool&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">CGImageRef</span> imageRef = image.<span class="type">CGImage</span>;</span><br><span class="line">        <span class="comment">// 当前设备的色彩空间，实现用了once_token</span></span><br><span class="line">        <span class="type">CGColorSpaceRef</span> colorspaceRef = <span class="type">SDCGColorSpaceGetDeviceRGB</span>();</span><br><span class="line">        <span class="type">BOOL</span> hasAlpha = <span class="type">SDCGImageRefContainsAlpha</span>(imageRef);</span><br><span class="line">        <span class="comment">// 位图信息：32位 + alpha信息</span></span><br><span class="line">        <span class="type">CGBitmapInfo</span> bitmapInfo = kCGBitmapByteOrder32Host;</span><br><span class="line">        bitmapInfo |= hasAlpha ? kCGImageAlphaPremultipliedFirst : kCGImageAlphaNoneSkipFirst;</span><br><span class="line">        size_t width = <span class="type">CGImageGetWidth</span>(imageRef);</span><br><span class="line">        size_t height = <span class="type">CGImageGetHeight</span>(imageRef);</span><br><span class="line">        <span class="comment">// 传入各种参数</span></span><br><span class="line">        <span class="type">CGContextRef</span> context = <span class="type">CGBitmapContextCreate</span>(<span class="type">NULL</span>,</span><br><span class="line">                                                     width,</span><br><span class="line">                                                     height,</span><br><span class="line">                                                     kBitsPerComponent,</span><br><span class="line">                                                     <span class="number">0</span>,</span><br><span class="line">                                                     colorspaceRef,</span><br><span class="line">                                                     bitmapInfo);</span><br><span class="line">        <span class="keyword">if</span> (context == <span class="type">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> image;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在上下文绘制图片</span></span><br><span class="line">        <span class="type">CGContextDrawImage</span>(context, <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, height), imageRef);</span><br><span class="line">        <span class="comment">// 创建图片</span></span><br><span class="line">        <span class="type">CGImageRef</span> imageRefWithoutAlpha = <span class="type">CGBitmapContextCreateImage</span>(context);</span><br><span class="line">        <span class="type">UIImage</span> *imageWithoutAlpha = [[<span class="type">UIImage</span> alloc] initWithCGImage:imageRefWithoutAlpha scale:image.scale orientation:image.imageOrientation];</span><br><span class="line">        <span class="type">CGContextRelease</span>(context);</span><br><span class="line">        <span class="type">CGImageRelease</span>(imageRefWithoutAlpha);</span><br><span class="line">        <span class="keyword">return</span> imageWithoutAlpha;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UI展示"><a href="#UI展示" class="headerlink" title="UI展示"></a>UI展示</h3><p>为UIImageView和UIButton提供了类别方法，可以方便的设置相应的图片属性。</p>
<h4 id="常用方法：-4"><a href="#常用方法：-4" class="headerlink" title="常用方法："></a>常用方法：</h4><p>为UIImageView设置图片</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)sd_setImageWithURL:(nullable <span class="type">NSURL</span> *)url</span><br><span class="line">          placeholderImage:(nullable <span class="type">UIImage</span> *)placeholder;</span><br></pre></td></tr></table></figure>
<p>添加图片加载Activity，定义在<code>UIView+WebCache</code>中。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)sd_setShowActivityIndicatorView:(<span class="type">BOOL</span>)show;</span><br></pre></td></tr></table></figure>

<p>自己做的SDWebImage框架脑图，赶脚有点大😂</p>
<p>图片管理模块</p>
<p><img src="/images/sdwebmanger.png" alt=""></p>
<p>图片下载工具模块</p>
<p><img src="/images/sddownloader.png" alt=""></p>
<p>图片缓存模块</p>
<p><img src="/images/sdcache.png" alt=""></p>
<p>图片解码模块</p>
<p><img src="/images/sdcoder.png" alt=""></p>
<p>扩展工具模块</p>
<p><img src="/images/sdextension.png" alt=""></p>
<p>其他模块</p>
<p><img src="/images/sdother.png" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/22/mac-soft-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/22/mac-soft-list/" class="post-title-link" itemprop="url">MAC上自己常用的软件清单</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-01-22 00:00:00" itemprop="dateCreated datePublished" datetime="2019-01-22T00:00:00+00:00">2019-01-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 05:59:05" itemprop="dateModified" datetime="2020-04-26T05:59:05+00:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index"><span itemprop="name">Mac</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>列一个自己在日常工作中经常用到的的MAC软件清单，以后重装电脑的时候就可以按照这个清单来下载了。</p>
<h4 id="常用Mac应用网站"><a href="#常用Mac应用网站" class="headerlink" title="常用Mac应用网站"></a>常用Mac应用网站</h4><ul>
<li><a href="http://xclient.info" target="_blank" rel="noopener">XClient</a> </li>
<li><a href="https://macwk.com/" target="_blank" rel="noopener">MacWk</a></li>
</ul>
<h4 id="应用无法安装，提示来源不明的开发者或者已破损"><a href="#应用无法安装，提示来源不明的开发者或者已破损" class="headerlink" title="应用无法安装，提示来源不明的开发者或者已破损"></a>应用无法安装，提示来源不明的开发者或者已破损</h4><p>打开终端，输入下面的命令后，键入Mac的登录密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo spctl --master-disable</span><br></pre></td></tr></table></figure>

<h4 id="通讯类"><a href="#通讯类" class="headerlink" title="通讯类"></a>通讯类</h4><ul>
<li><a href="http://im.qq.com/macqq/index.shtml" target="_blank" rel="noopener">QQ</a></li>
<li><a href="https://mac.weixin.qq.com/" target="_blank" rel="noopener">微信</a></li>
<li><a href="https://tms.dingtalk.com/markets/dingtalk/download?spm=a3140.8196062.2231602.8.53e35c3duetwd8" target="_blank" rel="noopener">钉钉</a></li>
</ul>
<h4 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h4><ul>
<li>思维导图：MindNode , XMind</li>
<li>流程图：OminiGraffle</li>
<li>视频播放：Movist, <a href="https://iina.io/" target="_blank" rel="noopener">IINA</a></li>
<li>FTP：YummyFTP, Transmit</li>
<li>虚拟机：ParallelsDesktop</li>
<li>解压缩工具：Archiver, BetterZip</li>
<li>浏览器：<a href="https://www.google.cn/chrome/index.html" target="_blank" rel="noopener">Chrome</a></li>
<li>笔记：<a href="https://www.yinxiang.com/download/?offer=www_menu" target="_blank" rel="noopener">印象笔记</a></li>
<li>翻墙必备：<a href="https://github.com/shadowsocks/ShadowsocksX-NG/releases/" target="_blank" rel="noopener">Shadowsocks</a></li>
<li>NTFS：<a href="https://my.paragon-software.com" target="_blank" rel="noopener">Paragon-NTFS</a></li>
<li>电脑清理：<a href="http://www.mycleanmymac.com/" target="_blank" rel="noopener">CleanMyMac</a></li>
<li>连接Android：<a href="https://www.smartisan.com/apps/#/handshaker" target="_blank" rel="noopener">HandShaker</a></li>
<li>iPhone数据备份：iPhone backup extractor</li>
<li>下载：<a href="https://mac.eltima.com/cn/download-manager.html" target="_blank" rel="noopener">Folx</a></li>
<li>批量设备App安装：<a href="https://apps.apple.com/cn/app/apple-configurator-2/id1037126344?mt=12" target="_blank" rel="noopener">Apple Configurator</a></li>
</ul>
<h4 id="办公类"><a href="#办公类" class="headerlink" title="办公类"></a>办公类</h4><ul>
<li>Office</li>
<li>WPS: <a href="https://pc.wps.cn/" target="_blank" rel="noopener">官网</a></li>
<li>邮件收发：<a href="http://www.foxmail.com/mac/" target="_blank" rel="noopener">Foxmail</a></li>
</ul>
<h4 id="图像处理"><a href="#图像处理" class="headerlink" title="图像处理"></a>图像处理</h4><ul>
<li>图像处理：Photoshop, Affinity Photo, Pixelmator</li>
<li>切图：Sketch</li>
<li>颜色提取：<a href="https://sipapp.io/" target="_blank" rel="noopener">Sip</a></li>
</ul>
<h4 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h4><ul>
<li>数据库：SQLPro for SQLite</li>
<li>抓包工具：Charles</li>
<li>接口调试：<a href="https://www.getpostman.com/" target="_blank" rel="noopener">Postman</a></li>
<li>iOS开发：<a href="https://itunes.apple.com/us/app/xcode/id497799835?mt=12" target="_blank" rel="noopener">Xcode</a></li>
<li>Web开发：<a href="https://www.jetbrains.com/webstorm/" target="_blank" rel="noopener">WebStorm</a></li>
<li>Java开发：<a href="https://www.jetbrains.com/idea/" target="_blank" rel="noopener">IDEA</a></li>
<li>小程序开发：<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener">微信Web开发者工具</a></li>
</ul>
<h4 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h4><ul>
<li>Git：<a href="https://cn.atlassian.com/software/sourcetree" target="_blank" rel="noopener">SourceTree</a> <a href="https://www.git-tower.com/" target="_blank" rel="noopener">Tower</a></li>
<li>SVN：Cornerstone</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/10/Web-Image-Orientation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/10/Web-Image-Orientation/" class="post-title-link" itemprop="url">web上传图片方向纠正</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-10 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-10T00:00:00+00:00">2018-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 05:59:04" itemprop="dateModified" datetime="2020-04-26T05:59:04+00:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91-web/" itemprop="url" rel="index"><span itemprop="name">iOS开发 web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近做的应用中有一个WKWebView加载了一个可以上传图片的网页，web端用<code>&lt;input type=&#39;file&#39;&gt;</code>标签上传文件。<br>随后发现在PC端用<code>&lt;img&gt;</code>展示的时候，图片发生了偏转。</p>
<p>具体大概是这个样子的，客户吐槽：多年的颈椎病都被治好了。<br><img src="/assets/images/webImageOrientation6.png" alt=""></p>
<p>因为只有通过iOS客户端上传的图片才会偏转，所以问了负责Android客户端的同学，原来Android的webView在文件上传前有回调，在回调里面对图片方向进行了处理。</p>
<p>于是我翻看了WKWebView头文件中相应代理的回调，并没有这种文件上传的回调，在网上看了一下其他人的解决方案，大致都是通过runtime替换了ViewController的<code>presentViewController: animated: completion:</code>和<code>dismissViewControllerAnimated: completion:</code>方法。</p>
<p>然后在方法中判断present的viewcontroller是否是<code>UIDocumentMenuViewController</code>类型，且代理是<code>WKFileUploadPanel</code>或<code>UIWebFileUploadPanel</code>，对其进行拦截，由自己接管后续图片的处理和上传，不过上传后，还是需要将图片URL传递给web网页展示，这样的话，Android客户端也需要进行相应的处理，改动就大了，所以放弃在iOS端改动。具体参考链接：<a href="https://github.com/frog78/Gigi" target="_blank" rel="noopener">iOS拦截&lt;input&gt;标签</a></p>
<p>于是就只能在web端改代码了，web端旋转压缩图片的话，主要用的还是canvas。但是获取图片的方向的话，需要用到<a href="https://github.com/exif-js/exif-js" target="_blank" rel="noopener">exif.js</a>；</p>
<p>废话不多说，上代码，首先引入exif.js：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/exif.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>监听input标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span> <span class="attr">class</span>=<span class="string">"uploadInput"</span> <span class="attr">style</span>=<span class="string">"display: none"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">$(<span class="string">".uploadInput"</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> file = e.target.files[<span class="number">0</span>];</span></span><br><span class="line"><span class="actionscript">    FixImg(file, <span class="function"><span class="keyword">function</span> <span class="params">(imgFile)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 上传图片</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> formdata = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="actionscript">        formdata.append(<span class="string">'file'</span>, imgFile);</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">            url: <span class="string">'upload.do'</span>,</span></span><br><span class="line"><span class="actionscript">            type: <span class="string">'POST'</span>,</span></span><br><span class="line">            data: formdata,</span><br><span class="line"><span class="actionscript">            processData: <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">            contentType: <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">            success: <span class="function"><span class="keyword">function</span> <span class="params">(res)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">// 图片上传成功</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>具体压缩旋转函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FixImg</span>(<span class="params">file, callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//图片压缩质量</span></span><br><span class="line">    <span class="keyword">var</span> quality = <span class="number">0.65</span>;</span><br><span class="line">    <span class="comment">// 定义所需变量</span></span><br><span class="line">    <span class="keyword">let</span> Orientation, ctxWidth, ctxHeight, base64; </span><br><span class="line">    <span class="comment">// EXIF 获取图片方向信息</span></span><br><span class="line">    EXIF.getData(file, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        Orientation = EXIF.getTag(<span class="keyword">this</span>, <span class="string">'Orientation'</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> fileReader = <span class="keyword">new</span> FileReader();</span><br><span class="line">        fileReader.readAsDataURL(file);</span><br><span class="line">        fileReader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> res = event.target.result;</span><br><span class="line">            <span class="keyword">var</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">            image.src = res;</span><br><span class="line">            image.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">                ctxWidth = <span class="keyword">this</span>.naturalWidth;</span><br><span class="line">                ctxHeight = <span class="keyword">this</span>.naturalHeight;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">                <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"></span><br><span class="line">                canvas.width = ctxWidth;</span><br><span class="line">                canvas.height = ctxHeight;</span><br><span class="line">                <span class="keyword">if</span> ([<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>].includes(Orientation)) &#123;</span><br><span class="line">                    canvas.width = ctxHeight;</span><br><span class="line">                    canvas.height = ctxWidth;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">switch</span> (Orientation) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                        ctx.transform(<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, ctxWidth, <span class="number">0</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                        ctx.transform(<span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, ctxWidth, ctxHeight;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                        ctx.transform(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>, ctxHeight);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                        ctx.transform(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                        ctx.transform(<span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>, <span class="number">0</span>, ctxHeight, <span class="number">0</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                        ctx.transform(<span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">0</span>, ctxHeight, ctxWidth;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                        ctx.transform(<span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, ctxWidth);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        ctx.transform(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ctx.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, ctxWidth, ctxHeight);</span><br><span class="line"></span><br><span class="line">                canvas.toBlob(<span class="function"><span class="keyword">function</span> (<span class="params">blob</span>) </span>&#123;</span><br><span class="line">                    <span class="comment">// 上传接口只接受file，所以blob转为file再上传</span></span><br><span class="line">                    <span class="keyword">let</span> files = <span class="keyword">new</span> <span class="built_in">window</span>.File([blob], file.name, &#123;<span class="attr">type</span>: file.type&#125;)</span><br><span class="line">                    callback(files);</span><br><span class="line">                &#125;, <span class="string">'multipart/form-data'</span>, quality)</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/15/iOS-Health/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/15/iOS-Health/" class="post-title-link" itemprop="url">iOS HealthKit 接入</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-15 00:00:00" itemprop="dateCreated datePublished" datetime="2018-08-15T00:00:00+00:00">2018-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 05:59:05" itemprop="dateModified" datetime="2020-04-26T05:59:05+00:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">iOS开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>HealthKit是苹果提供的一个健康数据接入库，开发人员可以由此读取、写入健康数据，不过依旧是需要先获取相应的接入权限才能使用。</p>
<p>以读取和写入健康步数为例，首先用Xcode新建一个空白项目，然后配置项目相应的选项：</p>
<ol>
<li><p>info.plist 添加<code>NSHealthUpdateUsageDescription</code>和<code>NSHealthShareUsageDescription</code>;</p>
</li>
<li><p>Capabilities选项中打开<code>HealthKit</code>;</p>
</li>
<li><p>BuildPhases选项中添加<code>HealthKit.frmaework</code>;</p>
</li>
</ol>
<p>写一个工具类<code>HKHandle</code>，用来判断设备是否支持HealthKit、请求相应权限之类的功能，二话不说上代码。</p>
<h3 id="HKHandle-h-文件，定义几个常用的接口："><a href="#HKHandle-h-文件，定义几个常用的接口：" class="headerlink" title="HKHandle.h 文件，定义几个常用的接口："></a>HKHandle.h 文件，定义几个常用的接口：</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HKHandle.h</span></span><br><span class="line">#<span class="keyword">import</span> &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#<span class="keyword">import</span> &lt;HealthKit/HealthKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface <span class="type">HKHandle</span> : <span class="type">NSObject</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HealthKit 实例，全局最好只有一个store</span></span><br><span class="line">+ (<span class="type">HKHealthStore</span> *)singleStore;</span><br><span class="line"><span class="comment">// 默认要访问的HealthKit权限</span></span><br><span class="line">+ (<span class="type">NSSet</span> *)defaultHKSet;</span><br><span class="line"><span class="comment">// 请求获取HealthKit权限</span></span><br><span class="line">+ (void)requsetDefaultAuth:(void(^)(<span class="type">BOOL</span> suc, <span class="type">NSString</span> *msg))complention;</span><br><span class="line"><span class="comment">// 写入数据的设备信息，非必需</span></span><br><span class="line">+ (<span class="type">HKDevice</span> *)defaultDevice;</span><br><span class="line"><span class="comment">// 读取健康数据</span></span><br><span class="line">+ (void)readDataWithSampleType:(<span class="type">HKSampleType</span> *)type completion:(void(^)(<span class="type">NSArray</span> *results, <span class="type">NSError</span> *error))completion;</span><br><span class="line"><span class="comment">// 保存健康数据</span></span><br><span class="line">+ (void)saveHKObject:(<span class="type">HKObject</span> *)obj completion:(void (^) (<span class="type">BOOL</span> suc, <span class="type">NSError</span> *error))completion;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<h3 id="HKHandle-m文件，接口的具体实现："><a href="#HKHandle-m文件，接口的具体实现：" class="headerlink" title="HKHandle.m文件，接口的具体实现："></a>HKHandle.m文件，接口的具体实现：</h3><p>生成单例store对象，用于存储健康数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="type">HKHealthStore</span> *)singleStore&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="type">HKHealthStore</span> *store;</span><br><span class="line">    <span class="keyword">static</span> dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        store = [[<span class="type">HKHealthStore</span> alloc] <span class="keyword">init</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> store;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>健康数据类型，这里只有步数类型：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="type">NSSet</span> *)defaultHKSet</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 步数</span></span><br><span class="line">    <span class="type">NSSet</span> *<span class="keyword">set</span> = [<span class="type">NSSet</span> setWithObjects:</span><br><span class="line">                  [<span class="type">HKQuantityType</span> quantityTypeForIdentifier:<span class="type">HKQuantityTypeIdentifierStepCount</span>],<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">set</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>判断设备是否支持，请求HealthKit权限：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ (void)requsetDefaultAuth:(void(^)(<span class="type">BOOL</span> suc, <span class="type">NSString</span> *msg))complention&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">HKHealthStore</span> *store = [<span class="keyword">self</span> singleStore];</span><br><span class="line">    <span class="keyword">if</span> (![<span class="type">HKHealthStore</span> isHealthDataAvailable])&#123;</span><br><span class="line">        <span class="comment">// 设备不支持 HealthKit</span></span><br><span class="line">        <span class="keyword">if</span> (complention)&#123;</span><br><span class="line">            complention(<span class="type">NO</span>, @<span class="string">"设备不支持HealthKit"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 请求相应健康权限</span></span><br><span class="line">    <span class="type">NSSet</span> *hkset = [<span class="keyword">self</span> defaultHKSet];</span><br><span class="line">    [store requestAuthorizationToShareTypes:hkset readTypes:hkset completion:^(<span class="type">BOOL</span> success, <span class="type">NSError</span> * _Nullable error) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">NSLog</span>(@<span class="string">"auth success = %@, error = %@"</span>,@(success), error);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (complention)&#123;</span><br><span class="line">            complention(success, error.localizedDescription);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>⚠️健康数据的读取和写入，都需要先获得相应的权限</em></p>
<p>读取步数：<br>HealthKit读取数据，需要一个query对象，步数读取需要<code>HKSampleQuery</code>类型的query。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">+ (void)readDataWithSampleType:(<span class="type">HKSampleType</span> *)type completion:(void(^)(<span class="type">NSArray</span> *results, <span class="type">NSError</span> *error))completion&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">NSPredicate</span> *predicate = [<span class="keyword">self</span> todayPredicate];</span><br><span class="line">    </span><br><span class="line">    <span class="type">HKSampleQuery</span> *query = [[<span class="type">HKSampleQuery</span> alloc] initWithSampleType:type predicate:predicate limit:<span class="type">HKObjectQueryNoLimit</span> sortDescriptors:<span class="literal">nil</span> resultsHandler:^(<span class="type">HKSampleQuery</span> * _Nonnull query, <span class="type">NSArray</span>&lt;__kindof <span class="type">HKSample</span> *&gt; * _Nullable results, <span class="type">NSError</span> * _Nullable error) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (completion)&#123;</span><br><span class="line">            </span><br><span class="line">            completion(results, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="type">HKHealthStore</span> *store = [<span class="keyword">self</span> singleStore];</span><br><span class="line">    [store executeQuery:query];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">NSPredicate</span> *)todayPredicate&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">NSCalendar</span> *calendar = [<span class="type">NSCalendar</span> currentCalendar];</span><br><span class="line">    <span class="type">NSDate</span> *now = [<span class="type">NSDate</span> date];</span><br><span class="line">    <span class="type">NSDateComponents</span> *components = [calendar components:<span class="type">NSCalendarUnitYear</span>|<span class="type">NSCalendarUnitMonth</span>|<span class="type">NSCalendarUnitDay</span> fromDate:now];</span><br><span class="line">    <span class="type">NSDate</span> *startDate = [calendar dateFromComponents:components];</span><br><span class="line">    <span class="type">NSDate</span> *endDate = [calendar dateByAddingUnit:<span class="type">NSCalendarUnitDay</span> value:<span class="number">1</span> toDate:startDate options:<span class="number">0</span>];</span><br><span class="line">    <span class="type">NSPredicate</span> *predicate = [<span class="type">HKQuery</span> predicateForSamplesWithStartDate:startDate endDate:endDate options:<span class="type">HKQueryOptionStrictStartDate</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> predicate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取到步数的处理：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">IBAction</span>)readSteps:(id)sender &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">HKSampleType</span> *stepType = [<span class="type">HKSampleType</span> quantityTypeForIdentifier:<span class="type">HKQuantityTypeIdentifierStepCount</span>];</span><br><span class="line">    [<span class="type">HKHandle</span> readDataWithSampleType:stepType completion:^(<span class="type">NSArray</span> *results, <span class="type">NSError</span> *error) &#123;</span><br><span class="line">        <span class="comment">// 切换主线程</span></span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">           </span><br><span class="line">            <span class="keyword">if</span> (!results)&#123;</span><br><span class="line">                <span class="type">NSLog</span>(@<span class="string">"查询失败了 error = %@"</span>,error);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">NSInteger</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">HKQuantitySample</span> *sample <span class="keyword">in</span> results) &#123;</span><br><span class="line">                double <span class="built_in">count</span> = [sample.quantity doubleValueForUnit:[<span class="type">HKUnit</span> countUnit]];</span><br><span class="line">                sum += <span class="built_in">count</span>;</span><br><span class="line">                <span class="type">NSLog</span>(@<span class="string">"count = %@"</span>,@(<span class="built_in">count</span>));</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">self</span>.title = [<span class="type">NSString</span> stringWithFormat:@<span class="string">"%@"</span>,@(sum)];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通用保存健康数据接口：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用保存接口</span></span><br><span class="line">+ (void)saveHKObject:(<span class="type">HKObject</span> *)obj completion:(void (^) (<span class="type">BOOL</span> suc, <span class="type">NSError</span> *error))completion&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (![obj isKindOfClass:[<span class="type">HKObject</span> <span class="class"><span class="keyword">class</span>]])</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">HKHealthStore</span> *store = [<span class="keyword">self</span> singleStore];</span><br><span class="line">    <span class="comment">// 保存健康数据</span></span><br><span class="line">    [store saveObject:obj withCompletion:^(<span class="type">BOOL</span> success, <span class="type">NSError</span> * _Nullable error) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (completion)&#123;</span><br><span class="line">            </span><br><span class="line">            completion(success, error);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;]; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成步数，调用写入接口:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成步数，调用接口写入</span></span><br><span class="line">- (<span class="type">IBAction</span>)writeSetp:(id)sender &#123;</span><br><span class="line">    [<span class="keyword">self</span>.view endEditing:<span class="type">YES</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_stepCount == <span class="number">0</span> || _startTime == <span class="literal">nil</span> || _endTime == <span class="literal">nil</span>)&#123;</span><br><span class="line">        [<span class="type">UIAlertController</span> showSimpleAlertWithTitle:@<span class="string">"提示"</span> message:@<span class="string">"请补充所有选项"</span> presentdViewController:<span class="keyword">self</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 步数</span></span><br><span class="line">    <span class="type">HKQuantity</span> *steps = [<span class="type">HKQuantity</span> quantityWithUnit:[<span class="type">HKUnit</span> countUnit] doubleValue:_stepCount];</span><br><span class="line">    </span><br><span class="line">    <span class="type">HKQuantitySample</span> *stepSample = [<span class="type">HKQuantitySample</span> quantitySampleWithType:[<span class="type">HKQuantityType</span> quantityTypeForIdentifier:<span class="type">HKQuantityTypeIdentifierStepCount</span>] quantity:steps startDate:_startTime endDate:_endTime device:[<span class="type">HKHandle</span> defaultDevice] metadata:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    [<span class="type">HKHandle</span> saveHKObject:stepSample completion:^(<span class="type">BOOL</span> suc, <span class="type">NSError</span> *error) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (suc)&#123;</span><br><span class="line">            </span><br><span class="line">            [<span class="type">UIAlertController</span> showSimpleAlertWithTitle:@<span class="string">"提示"</span> message:@<span class="string">"写入成功"</span> presentdViewController:<span class="keyword">self</span>];</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="type">NSLog</span>(@<span class="string">"写入失败，error = %@"</span>,error);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;]; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/15/dev-QA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/15/dev-QA/" class="post-title-link" itemprop="url">iOS开发过程中遇到的问题及解决方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-15 00:00:00" itemprop="dateCreated datePublished" datetime="2018-05-15T00:00:00+00:00">2018-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 05:59:05" itemprop="dateModified" datetime="2020-04-26T05:59:05+00:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">iOS开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>记录一下自己在日常的iOS开发过程中遇到的一些问题以及解决方法，方便以后查阅。</p>
<h3 id="SVN无法上传-a文件"><a href="#SVN无法上传-a文件" class="headerlink" title="SVN无法上传.a文件"></a>SVN无法上传.a文件</h3><p>Xcode自带的svn和Versions以及一些其它工具都有默认忽略<code>.a</code>文件。</p>
<p>在Versions中手动添加文件：<br>选择Versions的菜单View–&gt;Show Ignored Items，这样就会显示出ignored的文件，找到你要上传的<code>.a</code>文件，右键<code>Add</code>就可以了。</p>
<h3 id="Xcode-unable-to-run-app-in-simulator"><a href="#Xcode-unable-to-run-app-in-simulator" class="headerlink" title="Xcode unable to run app in simulator"></a>Xcode unable to run app in simulator</h3><p>Xcode 界面，<code>shift + command +2</code> 快速进入<code>devices</code>窗口，查看当前的可用设备，找到无法启动的模拟器，删除并重新创建一个新的模拟器，再次运行该模拟器即可</p>
<h3 id="Cannot-assign-to-self-out-of-a-method-in-the-init-family"><a href="#Cannot-assign-to-self-out-of-a-method-in-the-init-family" class="headerlink" title="Cannot assign to self out of a method in the init family?"></a>Cannot assign to self out of a method in the init family?</h3><p>初始化方法必须以init开头，并遵循驼峰命名法则</p>
<h3 id="file-has-been-modified-since-the-precompiled-header-was-built"><a href="#file-has-been-modified-since-the-precompiled-header-was-built" class="headerlink" title="file has been modified since the precompiled header was built"></a>file has been modified since the precompiled header was built</h3><p>在Mac终端删除derivedData：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/Library/Developer/Xcode/DerivedData</span><br></pre></td></tr></table></figure>
<p>重新clean build</p>
<h3 id="使用Storyboard页面跳转时，tableView的ContentOffset-莫名偏移"><a href="#使用Storyboard页面跳转时，tableView的ContentOffset-莫名偏移" class="headerlink" title="使用Storyboard页面跳转时，tableView的ContentOffset 莫名偏移"></a>使用Storyboard页面跳转时，tableView的ContentOffset 莫名偏移</h3><p>不要勾选xib文件的<code>Adjust Scroll View Insets</code></p>
<h3 id="UITableView-setEditing-YES-animation-YES-没有动画效果"><a href="#UITableView-setEditing-YES-animation-YES-没有动画效果" class="headerlink" title="UITableView setEditing:YES animation:YES 没有动画效果"></a>UITableView setEditing:YES animation:YES 没有动画效果</h3><p>因为后面再次调用了reloadData导致的。解决方法如下：</p>
<ul>
<li>方案一：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">CATransaction</span> begin];</span><br><span class="line">[<span class="type">CATransaction</span> setCompletionBlock: ^&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//animation 结束之后要运行的代码 </span></span><br><span class="line"></span><br><span class="line">&#125;]; </span><br><span class="line">[_tblView setEditing:<span class="type">YES</span> animated:<span class="type">YES</span>]; </span><br><span class="line">[<span class="type">CATransaction</span> commit];</span><br></pre></td></tr></table></figure>

<ul>
<li>方案二：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">UIView</span> animateWithDuration:<span class="number">0</span>.3f</span><br><span class="line">                 animations:^&#123;</span><br><span class="line">                    [<span class="keyword">self</span>.tableView setEditing:<span class="type">YES</span> animated:<span class="type">NO</span>];</span><br><span class="line">                 &#125;</span><br><span class="line">                 completion:^(<span class="type">BOOL</span> finished)&#123;</span><br><span class="line">                   <span class="comment">// animation 结束之后要运行的代码</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>





<h3 id="The-document-“MainStoryboard-storyboard”-could-not-be-opened-The-operation-couldn’t-be-completed-com-apple-InterfaceBuilder-error-1-Check-the-console-log-for-additional-information"><a href="#The-document-“MainStoryboard-storyboard”-could-not-be-opened-The-operation-couldn’t-be-completed-com-apple-InterfaceBuilder-error-1-Check-the-console-log-for-additional-information" class="headerlink" title="The document “MainStoryboard.storyboard” could not be opened. The operation couldn’t be completed. (com.apple.InterfaceBuilder error -1.) Check the console log for additional information."></a>The document “MainStoryboard.storyboard” could not be opened. The operation couldn’t be completed. (com.apple.InterfaceBuilder error -1.) Check the console log for additional information.</h3><p>1.open storyboard as <code>source code</code> </p>
<p>2.find <code>interredMetricsTieBreakers</code> block</p>
<p>3.remove all <code>&lt;segue reference = “” /&gt;</code></p>
<p>4.open storyboard as <code>interFace Builder</code></p>
<h3 id="The-document-“-xxxx-xib”-could-not-be-opened"><a href="#The-document-“-xxxx-xib”-could-not-be-opened" class="headerlink" title="The document “ xxxx.xib” could not be opened."></a>The document “ xxxx.xib” could not be opened.</h3><p>解决方案：</p>
<p>1.删除xib的 source code 里的冲突</p>
<p>2.右键.xib文件 -&gt; show file in inspector 文件type：default interface builder cocoa touch xib  (Xcode 7 点击一次ok)</p>
<h3 id="AVC的View自动加载AView的nib文件"><a href="#AVC的View自动加载AView的nib文件" class="headerlink" title="AVC的View自动加载AView的nib文件"></a>AVC的View自动加载AView的nib文件</h3><p>实例：iOS 10.3.3真机<br>工程中以前有一个名为RewardView的View源文件以及相应的nib文件，再新建一个RewardViewController的源文件不带nib文件，当RewardViewController初始化时，竟然把RewardView的nib文件加载进来啦啦啦，我也是无言以对，难道VC的View加载机制是优先加载命名类似的nib文件？？？</p>
<h3 id="用cocoapods安装的第三方库默认iOS-Deployment-Target-4-3，导致工程编译错误"><a href="#用cocoapods安装的第三方库默认iOS-Deployment-Target-4-3，导致工程编译错误" class="headerlink" title="用cocoapods安装的第三方库默认iOS Deployment Target 4.3，导致工程编译错误"></a>用cocoapods安装的第三方库默认iOS Deployment Target 4.3，导致工程编译错误</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">post_install <span class="keyword">do</span> |installer| </span><br><span class="line">    installer.pods_project.targets.each <span class="keyword">do</span> |target| </span><br><span class="line">        target.build_configurations.each <span class="keyword">do</span> |config| </span><br><span class="line">            config.build_settings['<span class="type">IPHONEOS_DEPLOYMENT_TARGET'</span>] = '<span class="number">8.0</span>' </span><br><span class="line">        end </span><br><span class="line">    end </span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>将上面的代码中的<code>8.0</code>替换成你要的系统版本号后，粘贴在<code>podfile</code>文件后面，执行<code>pod update</code> 或者 <code>pod install</code> 即可。</p>
<h4 id="iOS11tableView-cell-分割线问题"><a href="#iOS11tableView-cell-分割线问题" class="headerlink" title="iOS11tableView cell 分割线问题"></a>iOS11tableView cell 分割线问题</h4><p>没有通过nib加载的cell，都会出现系统的分割线，通过nib加载的cell不会出现分割线</p>
<h3 id="pods的第三方库有好多Warning"><a href="#pods的第三方库有好多Warning" class="headerlink" title="pods的第三方库有好多Warning"></a>pods的第三方库有好多Warning</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod '<span class="type">SSZipArchive'</span>, :inhibit_warnings =&gt; <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="自定义tabBarController的tabBar的title显示问题"><a href="#自定义tabBarController的tabBar的title显示问题" class="headerlink" title="自定义tabBarController的tabBar的title显示问题"></a>自定义tabBarController的tabBar的title显示问题</h3><p>自定义tabBar的title跟系统的title重影，不要直接设置<code>vc.title=@“”</code>，要设置<code>vc.navigationItem.title=@“”</code></p>
<h3 id="App想用http怎么办"><a href="#App想用http怎么办" class="headerlink" title="App想用http怎么办"></a>App想用http怎么办</h3><p>新版xcode已经默认项目使用HTTPS，想要用回http，只需在<code>info.plist</code> 添加key：<code>NSAppTransportSecurity</code> value:<code>Dictionary</code>，在<code>dictionary</code>下面添加<code>NSAllowsArbitraryLoads=YES</code>的键值对即可</p>
<h3 id="Xcode-8默认打印了一堆无用的log，怎么办？"><a href="#Xcode-8默认打印了一堆无用的log，怎么办？" class="headerlink" title="Xcode 8默认打印了一堆无用的log，怎么办？"></a>Xcode 8默认打印了一堆无用的log，怎么办？</h3><p>在Xcode选项中依次选择 Product -&gt; Scheme -&gt; Edit Scheme，调出工程Scheme编辑面板；或者使用快捷键 <code>Shift+Command+,</code> 调出Scheme编辑面板。</p>
<p>选中Run选项，在<code>Environment Variables</code>里面添加 <code>OS_ACTIVITY_MODE=Disable</code>，即可告别多余的日志信息。</p>
<p>但是真机调试的话，NSLog日志并不会出现，那我们就只用宏定义代替：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define <span class="type">CCLog</span>(...) printf(<span class="string">"%f %s\n"</span>,[[<span class="type">NSDate</span> date] timeIntervalSince1970],[[<span class="type">NSString</span> stringWithFormat:__VA_ARGS__] <span class="type">UTF8String</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="tableView-Cell分割线位置"><a href="#tableView-Cell分割线位置" class="headerlink" title="tableView Cell分割线位置"></a>tableView Cell分割线位置</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void)tableView:(<span class="type">UITableView</span> *)tableView willDisplayCell:(<span class="type">UITableViewCell</span> *)cell forRowAtIndexPath:(<span class="type">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Remove separator inset</span></span><br><span class="line">    <span class="keyword">if</span> ([cell respondsToSelector:@selector(setSeparatorInset:)]) &#123;</span><br><span class="line">        [cell setSeparatorInset:<span class="type">UIEdgeInsetsMake</span>(<span class="number">0</span>, tableView.frame.size.width, <span class="number">0</span>, <span class="number">0</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Prevent the cell from inheriting the Table View's margin settings</span></span><br><span class="line">    <span class="keyword">if</span> ([cell respondsToSelector:@selector(setPreservesSuperviewLayoutMargins:)]) &#123;</span><br><span class="line">        [cell setPreservesSuperviewLayoutMargins:<span class="type">NO</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Explictly set your cell's layout margins</span></span><br><span class="line">    <span class="keyword">if</span> ([cell respondsToSelector:@selector(setLayoutMargins:)]) &#123;</span><br><span class="line">        [cell setLayoutMargins:<span class="type">UIEdgeInsetsMake</span>(<span class="number">0</span>, tableView.frame.size.width, <span class="number">0</span>, <span class="number">0</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="如何实现斜纹背景"><a href="#如何实现斜纹背景" class="headerlink" title="如何实现斜纹背景"></a>如何实现斜纹背景</h3><p>项目中需要实现这样的效果：<br><img src="/assets/images/stripe.png" alt=""></p>
<p>每个半小时区间需要斜纹背景填充，可以用UIView或者CALayer实现。<br>UIView实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> - (void)drawRect:(<span class="type">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取当前context</span></span><br><span class="line">    <span class="type">CGFloat</span> width = <span class="keyword">self</span>.frame.size.width;</span><br><span class="line">    <span class="type">CGFloat</span> height = <span class="keyword">self</span>.frame.size.height;</span><br><span class="line">    <span class="type">CGContextRef</span> ctx = <span class="type">UIGraphicsGetCurrentContext</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 画矩形，填充背景色</span></span><br><span class="line">    <span class="type">CGContextAddRect</span>(ctx, <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, height));</span><br><span class="line">    [[<span class="type">UIColor</span> colorWithHex:@<span class="string">"#e9e9e9"</span>] <span class="keyword">set</span>];</span><br><span class="line">    <span class="type">CGContextFillPath</span>(ctx);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 画斜纹线条</span></span><br><span class="line">    <span class="type">CGFloat</span> offset = <span class="number">50</span>;</span><br><span class="line">    [[<span class="type">UIColor</span> colorWithHex:@<span class="string">"#dadada"</span>] <span class="keyword">set</span>];</span><br><span class="line">    <span class="type">NSInteger</span> <span class="built_in">count</span> = ceilf((width + offset) * <span class="number">1</span>.0f / <span class="number">5.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">NSMutableArray</span> *startPoints = [<span class="type">NSMutableArray</span> array];</span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="built_in">count</span>; i ++)&#123;</span><br><span class="line">        <span class="type">CGPoint</span> startPoint = <span class="type">CGPointMake</span>(<span class="number">5</span> * i - offset, height);</span><br><span class="line">        <span class="type">NSValue</span> *value = [<span class="type">NSValue</span> valueWithCGPoint:startPoint];</span><br><span class="line">        [startPoints addObject:value];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">NSMutableArray</span> *endPoints = [<span class="type">NSMutableArray</span> array];</span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="built_in">count</span>; i ++)&#123;</span><br><span class="line">        <span class="type">CGPoint</span> endPoint = <span class="type">CGPointMake</span>(<span class="number">5</span> * i, <span class="number">0</span>);</span><br><span class="line">        <span class="type">NSValue</span> *value = [<span class="type">NSValue</span> valueWithCGPoint:endPoint];</span><br><span class="line">        [endPoints addObject:value];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; startPoints.<span class="built_in">count</span>; i ++)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">CGPoint</span> startPoint = [[startPoints objectAtIndex:i] <span class="type">CGPointValue</span>];</span><br><span class="line">        <span class="type">CGPoint</span> endPoint = [[endPoints objectAtIndex:i] <span class="type">CGPointValue</span>];</span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(ctx, startPoint.x, startPoint.y);</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(ctx, endPoint.x, endPoint.y);</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(ctx);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CALayer实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">CAShapeLayer</span> *)invalidLayerWidthFrame:(<span class="type">CGRect</span>)frame&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建CGPath</span></span><br><span class="line">    <span class="type">CGMutablePathRef</span> path = <span class="type">CGPathCreateMutable</span>();</span><br><span class="line">    <span class="comment">// 创建layer，设置layer绘制颜色</span></span><br><span class="line">    <span class="type">CAShapeLayer</span> *oneLayer = [<span class="type">CAShapeLayer</span> layer];</span><br><span class="line">    oneLayer.fillColor = [<span class="type">UIColor</span> whiteColor].<span class="type">CGColor</span>;</span><br><span class="line">    oneLayer.strokeColor = [<span class="type">UIColor</span> blueColor].<span class="type">CGColor</span>;</span><br><span class="line">    oneLayer.lineWidth = <span class="number">1</span>.0f;</span><br><span class="line">    oneLayer.masksToBounds = <span class="type">YES</span>;</span><br><span class="line">    oneLayer.frame = frame;</span><br><span class="line">    oneLayer.backgroundColor = [<span class="type">UIColor</span> lightGrayColor].<span class="type">CGColor</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 定义斜线间距、起始点与终止点X轴偏移量</span></span><br><span class="line">    <span class="type">CGFloat</span> offsetX = <span class="number">50</span>;</span><br><span class="line">    <span class="type">CGFloat</span> spaceX = <span class="number">5</span>;</span><br><span class="line">    <span class="type">NSInteger</span> <span class="built_in">count</span> = ceilf((frame.size.width + offsetX) * <span class="number">1</span>.0f / spaceX);</span><br><span class="line">    </span><br><span class="line">    <span class="type">NSMutableArray</span> *startPoints = [<span class="type">NSMutableArray</span> array];</span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="built_in">count</span>; i ++)&#123;</span><br><span class="line">        <span class="type">CGPoint</span> startPoint = <span class="type">CGPointMake</span>(spaceX * i - offsetX, frame.size.height);</span><br><span class="line">        <span class="type">NSValue</span> *value = [<span class="type">NSValue</span> valueWithCGPoint:startPoint];</span><br><span class="line">        [startPoints addObject:value];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">NSMutableArray</span> *endPoints = [<span class="type">NSMutableArray</span> array];</span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="built_in">count</span>; i ++)&#123;</span><br><span class="line">        <span class="type">CGPoint</span> endPoint = <span class="type">CGPointMake</span>(spaceX * i, <span class="number">0</span>);</span><br><span class="line">        <span class="type">NSValue</span> *value = [<span class="type">NSValue</span> valueWithCGPoint:endPoint];</span><br><span class="line">        [endPoints addObject:value];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; startPoints.<span class="built_in">count</span>; i ++)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">CGPoint</span> startPoint = [[startPoints objectAtIndex:i] <span class="type">CGPointValue</span>];</span><br><span class="line">        <span class="type">CGPoint</span> endPoint = [[endPoints objectAtIndex:i] <span class="type">CGPointValue</span>];</span><br><span class="line">        <span class="type">CGPathMoveToPoint</span>(path, <span class="type">NULL</span>, startPoint.x, startPoint.y);</span><br><span class="line">        <span class="type">CGPathAddLineToPoint</span>(path, <span class="type">NULL</span>, endPoint.x, endPoint.y);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    oneLayer.path = path;</span><br><span class="line">    <span class="keyword">return</span> oneLayer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Xcode启动图正确添加后不显示"><a href="#Xcode启动图正确添加后不显示" class="headerlink" title="Xcode启动图正确添加后不显示"></a>Xcode启动图正确添加后不显示</h3><p>先利用Assets方式添加启动图：</p>
<p>1、在Assets.xcassets -&gt; LaunchImage图片集中添加各种分辨率启动图片</p>
<p>2、如有<code>LaunchScreen.storyboard</code>文件，关闭Xcode General选项卡中 <code>use as Launch Screen</code>选项</p>
<p>3、<code>General</code>选项改动，<code>Launch Images Source</code> 改为 <code>LaunchImage图片集</code>；<code>Launch Screen File</code> 置空；<br>改动后重启一下Xcode才能选择已有的启动图片集，然后删除已安装的App再运行才能看到效果😂</p>
<h3 id="蓝牙不能自动扫描"><a href="#蓝牙不能自动扫描" class="headerlink" title="蓝牙不能自动扫描"></a>蓝牙不能自动扫描</h3><p>创建好<code>CBCentralManager</code> 后需要在<code>viewController</code> 的 <code>viewDidAppear</code>时执行扫描</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mCentralManager = [[<span class="type">CBCentralManager</span> alloc] initWithDelegate:<span class="keyword">self</span> queue:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">- (void)viewDidAppear:(<span class="type">BOOL</span>)animated&#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    <span class="type">CBUUID</span> *serviceUUID = [<span class="type">CBUUID</span> <span class="type">UUIDWithString</span>:@<span class="string">"00001101-0000-0100-8000-00805F9B34FB"</span>];</span><br><span class="line">    <span class="type">NSArray</span> *servicesArr = [<span class="type">NSArray</span> arrayWithObjects:serviceUUID,<span class="literal">nil</span>];</span><br><span class="line">    [mCentralManager scanForPeripheralsWithServices:servicesArr options:@&#123;<span class="type">CBCentralManagerScanOptionAllowDuplicatesKey</span>:@<span class="type">NO</span>&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="pod-update-获取不到最新repo"><a href="#pod-update-获取不到最新repo" class="headerlink" title="pod update 获取不到最新repo"></a>pod update 获取不到最新repo</h3><p>先删除本地的repos，再setup，终端执行以下命令：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf ~/.cocoapods/repos/master</span><br><span class="line">pod setup</span><br></pre></td></tr></table></figure>

<h3 id="iPhone-X导航栏多了一条线"><a href="#iPhone-X导航栏多了一条线" class="headerlink" title="iPhone X导航栏多了一条线"></a>iPhone X导航栏多了一条线</h3><p><img src="/assets/images/navi_line.png" alt=""></p>
<p>看了一下导航栏的view层级，没有发现什么高度为1的view，然后突然醒悟到，可能是导航栏背景图片尺寸的问题，换了高度为88的图片就没事了。</p>
<h3 id="LaunchScreen加载不到图片"><a href="#LaunchScreen加载不到图片" class="headerlink" title="LaunchScreen加载不到图片"></a>LaunchScreen加载不到图片</h3><p>将需要加载的图片，转为JPEG格式的图片，或者tiff格式，具体原因不明，如果出现启动无法加载，删除APP重装，或者重启手机也可以解决</p>
<h3 id="网络图片含有中文字符，导致sdwebimgage无法加载"><a href="#网络图片含有中文字符，导致sdwebimgage无法加载" class="headerlink" title="网络图片含有中文字符，导致sdwebimgage无法加载"></a>网络图片含有中文字符，导致sdwebimgage无法加载</h3><p>需要将URL使用utf8编码格式一下</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// iOS 9 之前</span></span><br><span class="line">imgUrl = \[urlStr stringByAddingPercentEscapesUsingEncoding:<span class="type">NSUTF8StringEncoding</span>];</span><br><span class="line"><span class="comment">// iOS 9 之后</span></span><br><span class="line">imgUrl = \[urlStr stringByAddingPercentEncodingWithAllowedCharacters:\[<span class="type">NSCharacterSet</span> <span class="type">URLQueryAllowedCharacterSet</span>]];</span><br></pre></td></tr></table></figure>
<h3 id="SVN-version-is-locked"><a href="#SVN-version-is-locked" class="headerlink" title="SVN version is locked"></a>SVN version is locked</h3><p>以CornerStone 为例，workingCopy，右键 -&gt; Clean</p>
<h3 id="SVN-报错-“An-error-occurred-while-contacting-the-repository-”"><a href="#SVN-报错-“An-error-occurred-while-contacting-the-repository-”" class="headerlink" title="SVN 报错 “An error occurred while contacting the repository.”"></a>SVN 报错 “An error occurred while contacting the repository.”</h3><p>删除钥匙串中SVN相关密码，重启SVN客户端。</p>
<h3 id="ScrollView代理scrollViewDidScroll-和scrollViewDidEndScrollingAnimation-执行了同样的业务代码，怎么防止执行多次呢？"><a href="#ScrollView代理scrollViewDidScroll-和scrollViewDidEndScrollingAnimation-执行了同样的业务代码，怎么防止执行多次呢？" class="headerlink" title="ScrollView代理scrollViewDidScroll:和scrollViewDidEndScrollingAnimation:执行了同样的业务代码，怎么防止执行多次呢？"></a>ScrollView代理scrollViewDidScroll:和scrollViewDidEndScrollingAnimation:执行了同样的业务代码，怎么防止执行多次呢？</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)scrollViewDidScroll:(<span class="type">UIScrollView</span> *)scrollView &#123;</span><br><span class="line">    <span class="comment">// 去执行did end scroll animation，</span></span><br><span class="line">    [<span class="type">NSObject</span> cancelPreviousPerformRequestsWithTarget:<span class="keyword">self</span>];</span><br><span class="line">    [<span class="keyword">self</span> performSelector:@selector(scrollViewDidEndScrollingAnimation:) withObject:scrollView afterDelay:<span class="number">0.1</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (void)scrollViewDidEndScrollingAnimation:(<span class="type">UIScrollView</span> *)scrollView &#123;</span><br><span class="line">    [<span class="type">NSObject</span> cancelPreviousPerformRequestsWithTarget:<span class="keyword">self</span>];</span><br><span class="line">    <span class="comment">// your code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Xcode使用cocoapods打包出来的ipa包里面包含了第三方库，增加了包体积。"><a href="#Xcode使用cocoapods打包出来的ipa包里面包含了第三方库，增加了包体积。" class="headerlink" title="Xcode使用cocoapods打包出来的ipa包里面包含了第三方库，增加了包体积。"></a>Xcode使用cocoapods打包出来的ipa包里面包含了第三方库，增加了包体积。</h3><p>删掉podfile里面的use_frame!</p>
<h3 id="webview激活键盘后，系统收起键盘会导致一系列问题，比如界面卡死，web内容消失等诡异现象"><a href="#webview激活键盘后，系统收起键盘会导致一系列问题，比如界面卡死，web内容消失等诡异现象" class="headerlink" title="webview激活键盘后，系统收起键盘会导致一系列问题，比如界面卡死，web内容消失等诡异现象"></a>webview激活键盘后，系统收起键盘会导致一系列问题，比如界面卡死，web内容消失等诡异现象</h3><p>自己主动收起键盘</p>
<h3 id="TabBar的未选中item颜色被渲染为灰色了"><a href="#TabBar的未选中item颜色被渲染为灰色了" class="headerlink" title="TabBar的未选中item颜色被渲染为灰色了"></a>TabBar的未选中item颜色被渲染为灰色了</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用原来的渲染</span></span><br><span class="line"><span class="type">UIImage</span> *originImage = [[<span class="type">UIImage</span> imageWithName:@“”] imageWithRenderingMode:<span class="type">UIImageRenderingModeAlwaysOriginal</span>];</span><br><span class="line"><span class="type">UITabBarItem</span> *barItem = [<span class="type">UITabBarItem</span> alloc] initWithTitle:@“title” image:originImage selectedImage:selectedImage];</span><br></pre></td></tr></table></figure>
<h3 id="xcode-select-error-tool-‘xcodebuild’-requires-Xcode"><a href="#xcode-select-error-tool-‘xcodebuild’-requires-Xcode" class="headerlink" title="xcode-select: error: tool ‘xcodebuild’ requires Xcode"></a>xcode-select: error: tool ‘xcodebuild’ requires Xcode</h3><p>xcodebuild需要调用Xcode去执行命令，但是xcode-select指向的路径是/Library/Developer/CommandLineTools，不是Xcode路径，所以将路径切换到Xcode路径下就OK了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/18/iOS-tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/18/iOS-tips/" class="post-title-link" itemprop="url">iOS开发小技巧</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-18 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-18T00:00:00+00:00">2018-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 05:59:05" itemprop="dateModified" datetime="2020-04-26T05:59:05+00:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">iOS开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文持续更新，主要记录自己在iOS开发过程中用到的一些小技巧，助力快速开发</p>
<h3 id="UIButton动态设置文字出现闪烁"><a href="#UIButton动态设置文字出现闪烁" class="headerlink" title="UIButton动态设置文字出现闪烁"></a>UIButton动态设置文字出现闪烁</h3><p>Button type不要使用system，要用custom</p>
<h3 id="tableView除掉多余空白行："><a href="#tableView除掉多余空白行：" class="headerlink" title="tableView除掉多余空白行："></a>tableView除掉多余空白行：</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableView.tableFooterView = [<span class="type">UIView</span> new];</span><br></pre></td></tr></table></figure>

<h3 id="自定义leftBarButtonItem导致左滑返回手势失效"><a href="#自定义leftBarButtonItem导致左滑返回手势失效" class="headerlink" title="自定义leftBarButtonItem导致左滑返回手势失效"></a>自定义leftBarButtonItem导致左滑返回手势失效</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.navigationItem.leftBarButtonItem = [[<span class="type">UIBarButtonItem</span> alloc] initWithImage:img style:<span class="type">UIBarButtonItemStylePlain</span> target:<span class="keyword">self</span> action:@selector(onBack:)];</span><br><span class="line"><span class="keyword">self</span>.navigationController.interactivePopGestureRecognizer.delegate = (id &lt;<span class="type">UIGestureRecognizerDelegate</span>&gt; )<span class="keyword">self</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ViewController中的scrollView出现莫名的frame位移或者contentOffset有偏差"><a href="#ViewController中的scrollView出现莫名的frame位移或者contentOffset有偏差" class="headerlink" title="ViewController中的scrollView出现莫名的frame位移或者contentOffset有偏差"></a>ViewController中的scrollView出现莫名的frame位移或者contentOffset有偏差</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// iOS 11 之前</span></span><br><span class="line"><span class="keyword">self</span>.automaticallyAdjustScrollViewInsets = <span class="type">NO</span>;</span><br><span class="line"><span class="keyword">self</span>.edgesForExtendedLayout = <span class="type">UIRectEdgeNone</span>;</span><br><span class="line"><span class="comment">// iOS 11</span></span><br><span class="line">scrollView.contentInsetAdjustmentBehavior = <span class="type">UIScrollViewContentInsetAdjustmentNever</span>;</span><br></pre></td></tr></table></figure>


<h3 id="页面滚动时，隐藏navigationbar"><a href="#页面滚动时，隐藏navigationbar" class="headerlink" title="页面滚动时，隐藏navigationbar"></a>页面滚动时，隐藏navigationbar</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigationController.hidesBarsOnSwipe = <span class="type">YES</span>;</span><br></pre></td></tr></table></figure>


<h3 id="拉伸图片的时候怎么才能让图片不变形"><a href="#拉伸图片的时候怎么才能让图片不变形" class="headerlink" title="拉伸图片的时候怎么才能让图片不变形"></a>拉伸图片的时候怎么才能让图片不变形</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIImage</span> *image = [[<span class="type">UIImage</span> imageNamed:@<span class="string">"xxx"</span>] stretchableImageWithLeftCapWidth:<span class="number">10</span> topCapHeight:<span class="number">10</span>];</span><br></pre></td></tr></table></figure>

<h3 id="把tableview里cell的小对勾的颜色改成别的颜色"><a href="#把tableview里cell的小对勾的颜色改成别的颜色" class="headerlink" title="把tableview里cell的小对勾的颜色改成别的颜色"></a>把tableview里cell的小对勾的颜色改成别的颜色</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableView.tintColor = [<span class="type">UIColor</span> redColor];</span><br></pre></td></tr></table></figure>

<h3 id="Navigationbar弄成透明的而不是带模糊的效果"><a href="#Navigationbar弄成透明的而不是带模糊的效果" class="headerlink" title="Navigationbar弄成透明的而不是带模糊的效果"></a>Navigationbar弄成透明的而不是带模糊的效果</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span>.navigationController.navigationBar setBackgroundImage:[<span class="type">UIImage</span> new] forBarMetrics:<span class="type">UIBarMetricsDefault</span>];</span><br><span class="line"><span class="keyword">self</span>.navigationController.navigationBar.shadowImage = [<span class="type">UIImage</span> new];</span><br><span class="line"><span class="keyword">self</span>.navigationController.navigationBar.translucent = <span class="type">YES</span>;</span><br></pre></td></tr></table></figure>

<h3 id="改变UITextField-placeholder的颜色和位置"><a href="#改变UITextField-placeholder的颜色和位置" class="headerlink" title="改变UITextField placeholder的颜色和位置"></a>改变UITextField placeholder的颜色和位置</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 继承UITextField 重写</span></span><br><span class="line">- (void)drawPlaceholderInRect:(<span class="type">CGRect</span>)rect &#123;</span><br><span class="line">    [[<span class="type">UIColor</span> blueColor] setFill];</span><br><span class="line">    [<span class="keyword">self</span>.placeholder drawInRect:rect withFont:<span class="keyword">self</span>.font lineBreakMode:<span class="type">UILineBreakModeTailTruncation</span> alignment:<span class="keyword">self</span>.textAlignment];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义NavigationBar的titleView"><a href="#自定义NavigationBar的titleView" class="headerlink" title="自定义NavigationBar的titleView"></a>自定义NavigationBar的titleView</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span> *titleView = [<span class="type">UIView</span> alloc] <span class="keyword">init</span>];</span><br><span class="line"><span class="keyword">self</span>.navigationItem.titleView = titleView;</span><br><span class="line"><span class="comment">// iOS 11 如果titleView上的button不响应，自定义titleView，加入@property (nonatomic, assign) CGSize intrinsicContentSize;</span></span><br><span class="line"><span class="type">CustomTitleView</span> *titleView = [<span class="type">CustomTitleView</span> alloc] <span class="keyword">init</span>];</span><br><span class="line">titleView.intrinsicContentSize = <span class="type">CGSizeMake</span>(<span class="number">100</span>,<span class="number">44</span>);</span><br><span class="line"><span class="keyword">self</span>.navigationItem.titleView = titleView;</span><br></pre></td></tr></table></figure>

<h3 id="UIScorllView-ContentSize-通过添加Masonry-layout约束确定尺寸"><a href="#UIScorllView-ContentSize-通过添加Masonry-layout约束确定尺寸" class="headerlink" title="UIScorllView ContentSize 通过添加Masonry layout约束确定尺寸"></a>UIScorllView ContentSize 通过添加Masonry layout约束确定尺寸</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建scrollView 添加约束确定frame</span></span><br><span class="line"><span class="type">UIScrollView</span> *scrollView = [[<span class="type">UIScrollView</span> alloc] <span class="keyword">init</span>]; </span><br><span class="line">[<span class="keyword">self</span>.view addSubview:scrollView]; </span><br><span class="line">[scrollView mas_makeConstraints:^(<span class="type">MASConstraintMaker</span> *make) &#123; </span><br><span class="line">    make.edges.equalTo(<span class="keyword">self</span>.view);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// 添加container到scrollView上，添加container到scrollview的各边边距，在通过指定container宽高决定contentSize</span></span><br><span class="line"><span class="type">UIView</span> *containerView = [[<span class="type">UIView</span> alloc] <span class="keyword">init</span>];</span><br><span class="line">[scrollView addSubview:containerView];</span><br><span class="line">[containerView mas_makeConstraints:^(<span class="type">MASConstraintMaker</span> *make) &#123;</span><br><span class="line"><span class="comment">// 指定container与scrollView边距，很关键</span></span><br><span class="line">    make.edges.equalTo(scrollView);</span><br><span class="line"><span class="comment">// 指定container宽度</span></span><br><span class="line">    make.width.equalTo(scrollView);</span><br><span class="line"><span class="comment">// 指定container高度，+1保证scrollView的bounds</span></span><br><span class="line">    make.height.equalTo(scrollView).offset(<span class="number">1</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<h3 id="WebView-获取HTML的title"><a href="#WebView-获取HTML的title" class="headerlink" title="WebView 获取HTML的title"></a>WebView 获取HTML的title</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)webView:(<span class="type">WKWebView</span> *)webView didFinishNavigation:(null_unspecified <span class="type">WKNavigation</span> *)navigation&#123;</span><br><span class="line">  </span><br><span class="line">    [webView evaluateJavaScript:@<span class="string">"document.title"</span> completionHandler:^(id _Nullable obj, <span class="type">NSError</span> * _Nullable error) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.title = [<span class="type">NSString</span> stringWithFormat:@<span class="string">"%@"</span>,obj];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="监听UITextField内容变化"><a href="#监听UITextField内容变化" class="headerlink" title="监听UITextField内容变化"></a>监听UITextField内容变化</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[textField addTarget:<span class="keyword">self</span> action:@selector(textfiledEditChanged:) forControlEvents:<span class="type">UIControlEventEditingChanged</span>];</span><br></pre></td></tr></table></figure>

<h3 id="Animation改变constraint"><a href="#Animation改变constraint" class="headerlink" title="Animation改变constraint"></a>Animation改变constraint</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">constraint.constant = <span class="number">100</span>;</span><br><span class="line">[<span class="type">UIView</span> animationWithDuration:.3f animations:^&#123;</span><br><span class="line">  [<span class="keyword">self</span>.view layoutIfNeeded];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<h3 id="不通过Xcode打包ipa"><a href="#不通过Xcode打包ipa" class="headerlink" title="不通过Xcode打包ipa"></a>不通过Xcode打包ipa</h3><p>Xcode <code>archive</code>后，在xcode的<code>Archives</code>中找到相应的<code>Archive包</code>，显示包内容，在<code>Products/Applications/</code>路径下面找到应用程序，在桌面新建<code>Payload</code>文件夹，将应用程序拖入<code>Payload</code>文件夹，压缩，改压缩包后缀为<code>.ipa</code>。</p>
<h3 id="XCode使用自定义字体"><a href="#XCode使用自定义字体" class="headerlink" title="XCode使用自定义字体"></a>XCode使用自定义字体</h3><ul>
<li>1、添加自定义字体.ttf到XCode工程；</li>
<li>2、info.plist添加key:<code>&lt;Fonts provided by application.</code>，value类型为<code>Array</code>，添加自定义字体名到Array；</li>
<li>3、确保Build Phases -&gt; Copy Bundle Resources 里面包含你的字体文件，不然不会显示字体</li>
<li>4、代码调用<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIFont</span> *digitFont = [<span class="type">UIFont</span> fontWithName:@<span class="string">"Impact"</span> size:<span class="number">38</span>];</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Xcode-忽略一些废除接口警告"><a href="#Xcode-忽略一些废除接口警告" class="headerlink" title="Xcode 忽略一些废除接口警告"></a>Xcode 忽略一些废除接口警告</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//-Wunused-variable 变量未使用 -Wdeprecated-declarations 使用废弃方法 -Wdocumentation 文档注释 </span></span><br><span class="line">pragma clang diagnostic push</span><br><span class="line">pragma clang diagnostic ignored <span class="string">"-Wdeprecated-declarations"</span></span><br><span class="line">   <span class="comment">//code 废弃的方法</span></span><br><span class="line">pragma clang diagnostic pop</span><br></pre></td></tr></table></figure>

<h3 id="TableView-点击空白收起键盘"><a href="#TableView-点击空白收起键盘" class="headerlink" title="TableView 点击空白收起键盘"></a>TableView 点击空白收起键盘</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UITapGestureRecognizer</span> \*tableViewGesture = \[\[<span class="type">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:@selector(tableViewTouchInSide)];</span><br><span class="line"><span class="comment">//是否取消点击处的其他action</span></span><br><span class="line">tableViewGesture.cancelsTouchesInView = <span class="type">NO</span>;</span><br><span class="line">[<span class="keyword">self</span>.subTableView addGestureRecognizer:tableViewGesture];</span><br><span class="line"></span><br><span class="line">- (void)tableViewTouchInSide&#123;</span><br><span class="line">    <span class="comment">// ------结束编辑，隐藏键盘</span></span><br><span class="line">    [<span class="keyword">self</span>.view endEditing:<span class="type">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Xcode-标记"><a href="#Xcode-标记" class="headerlink" title="Xcode 标记"></a>Xcode 标记</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: -</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> -</span></span><br><span class="line"><span class="comment">// <span class="doctag">FIXME:</span> -</span></span><br></pre></td></tr></table></figure>

<h3 id="iOS-11-tableView-刷新跳动"><a href="#iOS-11-tableView-刷新跳动" class="headerlink" title="iOS 11 tableView 刷新跳动"></a>iOS 11 tableView 刷新跳动</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tableView.estimatedRowHeight = <span class="number">0</span>;</span><br><span class="line">tableview.estimatedSectionHeaderHeight = <span class="number">0</span>;</span><br><span class="line">tableview.estimatedSectionFooterHeight = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Xcode-添加预编译文件"><a href="#Xcode-添加预编译文件" class="headerlink" title="Xcode 添加预编译文件"></a>Xcode 添加预编译文件</h3><p>1、新建<code>.pch</code>文件，勾选target<br>2、<code>building setting</code>选项卡中，搜索<code>pch</code>，找到 <code>Prefix Header</code>，添加 <code>$(SRCROOT)/YourProjectName/YourPCHFileName</code></p>
<h3 id="iOS状态栏样式设置"><a href="#iOS状态栏样式设置" class="headerlink" title="iOS状态栏样式设置"></a>iOS状态栏样式设置</h3><ul>
<li>通过代码设置样式或者隐藏，必须要在<code>Info.plist</code>中添加字段<code>View controller-based status bar appearance : NO</code><br>// 1、通过在工程的Info.plist文件中加入字段改变全局样式<br><code>UIStatusBarStyle : UIStatusBarStyleDefault/UIStatusBarStyleLightContent</code><br>// 2、代码全局设置样式，首先在<code>Info.plist</code>中加入字段，然后在<code>APPDelegate</code>中写下代码<br><code>View controller-based status bar appearance : NO</code><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">UIApplication</span> sharedApplication].statusBarStyle = <span class="type">UIStatusBarStyleLightContent</span>;</span><br></pre></td></tr></table></figure></li>
<li>单独设置状态栏背景颜色<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (void)setStatusBarBackgroundColor:(<span class="type">UIColor</span> *)color &#123; </span><br><span class="line">    <span class="type">UIView</span> *statusBar = [[[<span class="type">UIApplication</span> sharedApplication] valueForKey:@<span class="string">"statusBarWindow"</span>] valueForKey:@<span class="string">"statusBar"</span>]; </span><br><span class="line">    <span class="keyword">if</span> ([statusBar respondsToSelector:@selector(setBackgroundColor:)])&#123;</span><br><span class="line">        statusBar.backgroundColor = color; </span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="图片不变形拉伸"><a href="#图片不变形拉伸" class="headerlink" title="图片不变形拉伸"></a>图片不变形拉伸</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 低于iOS 5.0</span></span><br><span class="line">- (<span class="type">UIImage</span> *)stretchableImageWithLeftCapWidth:(<span class="type">NSInteger</span>)leftCapWidth topCapHeight:(<span class="type">NSInteger</span>)topCapHeight</span><br><span class="line"><span class="comment">// 高于iOS 5.0</span></span><br><span class="line">- (<span class="type">UIImage</span> *)resizableImageWithCapInsets:(<span class="type">UIEdgeInsets</span>)capInsets</span><br></pre></td></tr></table></figure>
<h3 id="优雅地退出App"><a href="#优雅地退出App" class="headerlink" title="优雅地退出App"></a>优雅地退出App</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 暴力强退，不会调用applicationWillTerminate，会被拒绝</span></span><br><span class="line">exit(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 苹果建议使用，会调用applicationWillTerminate，会被拒绝</span></span><br><span class="line">abort(), <span class="built_in">assert</span>(condition);</span><br><span class="line"><span class="comment">// 前两种退出会给用户造成一种App崩溃的赶脚，下面来一个优雅的方式，会使用到私有接口</span></span><br><span class="line"><span class="comment">// suspend 挂起程序，会给用户一种退入后台的感觉，然后延时调用terminateWithSuccess，直接干死App，或者使用上面的暴力手段，或者执行一个不存在的方法</span></span><br><span class="line">[[<span class="type">UIApplication</span> sharedApplication] performSelector:@selector(suspend) withObject:<span class="literal">nil</span> afterDelay:<span class="number">0</span>];</span><br><span class="line">[[<span class="type">UIApplication</span> sharedApplication] performSelector:@selector(terminateWithSuccess) withObject:<span class="literal">nil</span> afterDelay:<span class="number">0.4</span>];</span><br></pre></td></tr></table></figure>
<h3 id="NavigationBarItem间距调整"><a href="#NavigationBarItem间距调整" class="headerlink" title="NavigationBarItem间距调整"></a>NavigationBarItem间距调整</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// iOS 11,需要自定义button，重写AlignmentRectInsets属性</span></span><br><span class="line"><span class="type">UIButton</span> *customButton = [<span class="type">UIButton</span> buttonWithType:<span class="type">UIButtonTypeCustom</span>];</span><br><span class="line"><span class="comment">// you should do this in your own custom class</span></span><br><span class="line">customButton.overrideAlignmentRectInsets = <span class="type">UIEdgeInsetsMake</span>(<span class="number">0</span>, x, <span class="number">0</span>, -x); </span><br><span class="line">customButton.translatesAutoresizingMaskIntoConstraints = <span class="type">NO</span>;</span><br><span class="line"><span class="type">UIBarButtonItem</span> *item = [[<span class="type">UIBarButtonItem</span> alloc] initWithCustomView:customButton]</span><br><span class="line"><span class="comment">// fixed space item 调整间距</span></span><br><span class="line"><span class="type">UIBarButtonItem</span> *positiveSeparator = [[<span class="type">UIBarButtonItem</span> alloc] initWithBarButtonSystemItem:<span class="type">UIBarButtonSystemItemFixedSpace</span> target:<span class="literal">nil</span> action:<span class="literal">nil</span>];</span><br><span class="line">positiveSeparator.width = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">self</span>.navigationItem.leftBarButtonItems = @&#123;positiveSeparator, item, ...&#125;</span><br></pre></td></tr></table></figure>
<h3 id="XCode日志老是输出The-connection-to-service-named-com-apple-commcenter-coretelephony-xpc-was-invalidated"><a href="#XCode日志老是输出The-connection-to-service-named-com-apple-commcenter-coretelephony-xpc-was-invalidated" class="headerlink" title="XCode日志老是输出The connection to service named com.apple.commcenter.coretelephony.xpc was invalidated"></a>XCode日志老是输出The connection to service named com.apple.commcenter.coretelephony.xpc was invalidated</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 终端运行下面的命令</span><br><span class="line">xcrun simctl spawn booted log config --mode "level:off"  --subsystem com.apple.CoreTelephony</span><br></pre></td></tr></table></figure>
<h3 id="iOS中获取WIFI的SSID-名字-，非私有方法"><a href="#iOS中获取WIFI的SSID-名字-，非私有方法" class="headerlink" title="iOS中获取WIFI的SSID(名字)，非私有方法"></a>iOS中获取WIFI的SSID(名字)，非私有方法</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入头文件</span></span><br><span class="line">#<span class="keyword">import</span> &lt;SystemConfiguration/CaptiveNetwork.h&gt;</span><br><span class="line"><span class="comment">// 获取ssid</span></span><br><span class="line">- (<span class="type">NSDictionary</span> *)fetchSSIDInfo &#123;</span><br><span class="line">    <span class="type">NSArray</span> *interfaceNames = <span class="type">CFBridgingRelease</span>(<span class="type">CFCopySupportedInterfaces</span>());</span><br><span class="line">    <span class="type">NSDictionary</span> *<span class="type">SSIDInfo</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">NSString</span> *interfaceName <span class="keyword">in</span> interfaceNames)&#123;</span><br><span class="line">        <span class="type">SSIDInfo</span> = <span class="type">CFBridgingRelease</span>(<span class="type">CNCopyCurrentNetworkInfo</span>((__bridge <span class="type">CFStringRef</span>)interfaceName));</span><br><span class="line">        <span class="type">BOOL</span> isNotEmpty = (<span class="type">SSIDInfo</span>.<span class="built_in">count</span> &gt; <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (isNotEmpty)&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">SSIDInfo</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// iOS12 需要加入WIFI权限</span></span><br></pre></td></tr></table></figure>

</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/07/iOS-mutable-copy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="QSnowy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QSnowy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/07/iOS-mutable-copy/" class="post-title-link" itemprop="url">iOS深浅拷贝</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-07 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-07T00:00:00+00:00">2017-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 05:59:05" itemprop="dateModified" datetime="2020-04-26T05:59:05+00:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">iOS开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在iOS开发过程中，我们要对某个对象进行拷贝的时候，一般会用<code>copy</code>和<code>mutableCopy</code>两种方法，在刚接触iOS的时候，我一般把<code>copy</code>称为浅拷贝，<code>mutableCopy</code>称为深拷贝，但是随着不断踩坑，才发现对不同类型的对象执行拷贝操作，得到的结果跟自己的预期并不一致。然后看了网上诸多关于深浅拷贝的文章，再结合自己写代码测试，才慢慢理解到，其实iOS中的深浅拷贝得到的结果，是跟拷贝对象的类型有关系的。</p>
<p>在iOS开发中，一般情况下，拷贝对象大概分为3种：非集合对象、集合对象、自定义对象。好了，话不多讲，以下就是针对这三种不同类型对象所写的深浅拷贝测试代码。</p>
<h3 id="1、iOS中非集合类的深浅拷贝"><a href="#1、iOS中非集合类的深浅拷贝" class="headerlink" title="1、iOS中非集合类的深浅拷贝"></a>1、iOS中非集合类的深浅拷贝</h3><p>非集合类对象深浅拷贝示例代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- (void)stringCopy&#123;</span><br><span class="line">	<span class="type">NSString</span> *str = @<span class="string">"123456"</span>;</span><br><span class="line">	<span class="comment">// 内容内存地址不变，共用同一块内存</span></span><br><span class="line">	<span class="type">NSString</span> *cpyStr = [str copy];</span><br><span class="line">	<span class="comment">// 内容地址改变，另外开辟一块内存空间，内容可变</span></span><br><span class="line">	<span class="type">NSMutableString</span> *mutCpyStr = [str mutableCopy];</span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"NSString内容地址：str = %p; copyStr = %p; mutStr = %p;"</span>,str,cpyStr,mutCpyStr);</span><br><span class="line">	<span class="comment">// str = 0x10e6d9068; copyStr = 0x10e6d9068; mutStr = 0x604000253f20;</span></span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"NSstring指针地址：str = %p; copyStr = %p; mutStr = %p;"</span>,&amp;str,&amp;cpyStr,&amp;mutCpyStr);</span><br><span class="line">	<span class="comment">// str = 0x7fff51525be8; copyStr = 0x7fff51525be0; mutStr = 0x7fff51525bd8;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">- (void)mutableStringCopy&#123;</span><br><span class="line"></span><br><span class="line">   <span class="type">NSMutableString</span> *formatStr = [<span class="type">NSMutableString</span> stringWithFormat:@<span class="string">"呵呵哒🙄"</span>];</span><br><span class="line">   <span class="comment">// 内容地址改变，开辟一块内存空间，内容不可变</span></span><br><span class="line">   <span class="type">NSString</span> *cpyStr = [formatStr copy];</span><br><span class="line">   <span class="comment">// 内容地址改变，开辟一块内存空间，内容可变</span></span><br><span class="line">   <span class="type">NSMutableString</span> *mutCpyStr = [formatStr mutableCopy];</span><br><span class="line"></span><br><span class="line">   <span class="type">NSLog</span>(@<span class="string">"NSMutableString内容地址：str = %p; copyStr = %p; mutStr = %p;"</span>,formatStr,cpyStr,mutCpyStr);</span><br><span class="line">   <span class="comment">// str = 0x600000249690; copyStr = 0x600000249cc0; mutStr = 0x600000249750;</span></span><br><span class="line"></span><br><span class="line">   <span class="type">NSLog</span>(@<span class="string">"NSMutableString指针地址：str = %p; copyStr = %p; mutStr = %p;"</span>,&amp;formatStr,&amp;cpyStr,&amp;mutCpyStr);</span><br><span class="line">   <span class="comment">// str = 0x7fff51525be8; copyStr = 0x7fff51525be0; mutStr = 0x7fff51525bd8;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由上面的代码可以看出，<code>非集合对象</code>的拷贝规律是这样的：</p>
<ul>
<li>不可变的非集合对象<code>copy</code>，指针拷贝，共用同一片内存；</li>
<li>不可变的非集合对象<code>mutableCopy</code>，创建新内存空间，成为可变对象。</li>
<li>可变的非集合对象<code>copy</code>，创建新内存空间，成为不可变对象；</li>
<li>可变的非集合对象<code>mutableCopy</code>，创建新内存空间。</li>
</ul>
<h3 id="2、iOS中集合类的深浅拷贝"><a href="#2、iOS中集合类的深浅拷贝" class="headerlink" title="2、iOS中集合类的深浅拷贝"></a>2、iOS中集合类的深浅拷贝</h3><h4 id="集合类的拷贝主要分为下面三种类型："><a href="#集合类的拷贝主要分为下面三种类型：" class="headerlink" title="集合类的拷贝主要分为下面三种类型："></a>集合类的拷贝主要分为下面三种类型：</h4><ul>
<li>浅复制(shallow copy)：在浅复制操作时，对于被复制对象的每一层都是指针复制。</li>
<li>深复制(one-level-deep copy)：在深复制操作时，对于被复制对象，至少有一层是深复制。</li>
<li>完全复制(real-deep copy)：在完全复制操作时，对于被复制对象的每一层都是对象复制。</li>
</ul>
<p>来自苹果官方的解释图例：<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html" target="_blank" rel="noopener" title="官方链接">官方链接</a><br><img src="/assets/images/CopyingCollections.png" alt=""></p>
<p>集合的深浅拷贝示例代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">- (void)collectionCopy&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">NSString</span> *str = [<span class="type">NSString</span> stringWithFormat:@<span class="string">"呵呵哒"</span>]();</span><br><span class="line">	<span class="type">NSMutableString</span> *mutStr = [<span class="type">NSMutableString</span> stringWithFormat:@<span class="string">"萌萌哒"</span>]();</span><br><span class="line">	<span class="type">NSArray</span> *arr = [<span class="type">NSArray</span> arrayWithObjects:@<span class="string">"one"</span>, @<span class="string">"two"</span>, @<span class="string">"three"</span>, <span class="literal">nil</span>]();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 不可变集合对象只包含非集合对象</span></span><br><span class="line">	<span class="type">NSArray</span> *imutArr1 = [<span class="type">NSArray</span> arrayWithObjects:str, mutStr, <span class="literal">nil</span>]();</span><br><span class="line">	<span class="comment">// 浅复制，创建一个指针直接指向已有内存空间</span></span><br><span class="line">	<span class="type">NSArray</span> *cpyImutArr1 = [imutArr1 copy]();</span><br><span class="line">	<span class="comment">// 深复制，创建新的集合内存空间，新瓶装老酒</span></span><br><span class="line">	<span class="type">NSMutableArray</span> *mutCpyImutArr1 = [imutArr1 mutableCopy]();</span><br><span class="line">	<span class="comment">// 创建新的集合内存空间，并且对集合内元素进行 copy 操作</span></span><br><span class="line">	<span class="type">NSMutableArray</span> *initArr1 = [\[<span class="type">NSMutableArray</span> alloc]() initWithArray:imutArr1 copyItems:<span class="type">YES</span>];</span><br><span class="line">	<span class="comment">// 完全深复制，如果元素是自定义类型，需要实现NSCoding协议</span></span><br><span class="line">	<span class="type">NSArray</span> *deepCpyArr1 = [<span class="type">NSKeyedUnarchiver</span> unarchiveObjectWithData:\[<span class="type">NSKeyedArchiver</span> archivedDataWithRootObject:imutArr1]()];</span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"\n imutArr1 info : pointer = %p; content = %p; first = %p; second = %p; third = %p"</span>,&amp;imutArr1, imutArr1, imutArr1[<span class="number">0</span>](), imutArr1[<span class="number">1</span>](), imutArr1[<span class="number">2</span>]());</span><br><span class="line">	<span class="comment">// imutArr1 info : pointer = 0x7fff5d946bc8; content = 0x604000443960; first = 0x604000037520; second = 0x604000442d30; third = 0x6040004446e0</span></span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"\n cpyImutArr1 info : pointer = %p; content = %p; first = %p; second = %p; third = %p"</span>,&amp;cpyImutArr1, cpyImutArr1, cpyImutArr1[<span class="number">0</span>](), cpyImutArr1[<span class="number">1</span>](), cpyImutArr1[<span class="number">2</span>]());</span><br><span class="line">	<span class="comment">// cpyImutArr1 info : pointer = 0x7fff5d946bc0; content = 0x604000443960; first = 0x604000037520; second = 0x604000442d30; third = 0x6040004446e0</span></span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"\n mutCpyImutArr1 info : pointer = %p; content = %p; first = %p; second = %p; third = %p"</span>,&amp;mutCpyImutArr1, mutCpyImutArr1, mutCpyImutArr1[<span class="number">0</span>](), mutCpyImutArr1[<span class="number">1</span>](), mutCpyImutArr1[<span class="number">2</span>]());</span><br><span class="line">	<span class="comment">// mutCpyImutArr1 info : pointer = 0x7fff5d946bb8; content = 0x604000444290; first = 0x604000037520; second = 0x604000442d30; third = 0x6040004446e0</span></span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"\n initArr1 info : pointer = %p; content = %p; first = %p; second = %p; third = %p"</span>,&amp;initArr1, initArr1, initArr1[<span class="number">0</span>](), initArr1[<span class="number">1</span>](), initArr1[<span class="number">2</span>]());</span><br><span class="line">	<span class="comment">// initArr1 info : pointer = 0x7fff5d946bb0; content = 0x604000442e80; first = 0x604000037520; second = 0x604000231aa0; third = 0x6040004446e0</span></span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"\n deepCpyArr1 info : pointer = %p; content = %p; first = %p; second = %p; third = %p"</span>,&amp;deepCpyArr1, deepCpyArr1, deepCpyArr1[<span class="number">0</span>](), deepCpyArr1[<span class="number">1</span>](), deepCpyArr1[<span class="number">2</span>]());</span><br><span class="line">	<span class="comment">// deepCpyArr1 info : pointer = 0x7fff5d946ba8; content = 0x604000443210; first = 0x604000231ce0; second = 0x604000444710; third = 0x6040004441d0</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 可变集合对象包含集合对象</span></span><br><span class="line">	<span class="type">NSMutableArray</span> *mutArr2 = [<span class="type">NSMutableArray</span> arrayWithObjects:str, mutStr, arr, <span class="literal">nil</span>]();</span><br><span class="line">	<span class="comment">// 深复制，创建新的集合内存空间，内容不变，新的集合不可变</span></span><br><span class="line">	<span class="type">NSMutableArray</span> *cpyMutArr2 = [mutArr2 copy]();</span><br><span class="line">	<span class="comment">// 深复制，创建新的集合内存空间，内容不变</span></span><br><span class="line">	<span class="type">NSMutableArray</span> *mutCpyMutArr2 = [mutArr2 mutableCopy]();</span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"\n mutArr2 info : pointer = %p; content = %p; first = %p; second = %p; third = %p"</span>,&amp;mutArr2, mutArr2, mutArr2[<span class="number">0</span>](), mutArr2[<span class="number">1</span>](), mutArr2[<span class="number">2</span>]());</span><br><span class="line">	<span class="comment">// mutArr2 info : pointer = 0x7fff53507bc8; content = 0x60400025e2a0; first = 0x60400023fa40; second = 0x60400025d2b0; third = 0x60400025f710</span></span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"\n cpyMutArr2 info : pointer = %p; content = %p; first = %p; second = %p; third = %p"</span>,&amp;cpyMutArr2, cpyMutArr2, cpyMutArr2[<span class="number">0</span>](), cpyMutArr2[<span class="number">1</span>](), cpyMutArr2[<span class="number">2</span>]());</span><br><span class="line">	<span class="comment">// cpyMutArr2 info : pointer = 0x7fff53507bc0; content = 0x60400025d760; first = 0x60400023fa40; second = 0x60400025d2b0; third = 0x60400025f710</span></span><br><span class="line"></span><br><span class="line">	<span class="type">NSLog</span>(@<span class="string">"\n mutCpyImutArr1 info : pointer = %p; content = %p; first = %p; second = %p; third = %p"</span>,&amp;mutCpyMutArr2, mutCpyMutArr2, mutCpyMutArr2[<span class="number">0</span>](), mutCpyMutArr2[<span class="number">1</span>](), mutCpyMutArr2[<span class="number">2</span>]());</span><br><span class="line">	<span class="comment">// mutCpyImutArr1 info : pointer = 0x7fff53507bb8; content = 0x60400025d310; first = 0x60400023fa40; second = 0x60400025d2b0; third = 0x60400025f710</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过代码和日志可以看出：</p>
<ul>
<li><code>不可变集合</code>的拷贝规律大概是这样的：</li>
</ul>
<p><code>[immutableObject copy]</code> <strong>浅复制，指针复制</strong></p>
<p><code>[immutableObject mutableCopy]</code> <strong>深复制，不是完全复制，容器是新的可变容器，内容还是旧的</strong></p>
<ul>
<li><code>可变集合</code>的拷贝规律大概是这样的：</li>
</ul>
<p><code>[mutableObject copy]</code> <strong>深复制 返回对象为immutable</strong></p>
<p><code>[mutableObject mutableCopy]</code> <strong>深复制，不是完全复制，容器是新的可变容器，内容还是旧的</strong></p>
<p>若想要实现完全拷贝，则需要使用下面的代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSArray</span> *newArr = [<span class="type">NSKeyedUnarchiver</span> unarchiveObjectWithData:[<span class="type">NSKeyedArchiver</span> archivedDataWithRootObject:oldArr]];</span><br></pre></td></tr></table></figure>

<p>至于拷贝后的集合是否可变，则跟旧集合的是否可变一致。值得注意的是，如果集合内含有自定义的类对象，则该类需要实现 <code>NSCoding</code> 协议。</p>
<p>如果根据集合重新<code>init</code>一个新的集合出来，就像这样子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSMutableArray</span> *newArr = [[<span class="type">NSMutableArray</span> alloc] initWithArray:arr copyItems:<span class="type">YES</span>];</span><br></pre></td></tr></table></figure>

<p>那么生成的新集合中的元素，并不一定都是完全拷贝的。因为执行上面的代码，只会对集合内的元素执行 <code>copy</code>方法。</p>
<h3 id="3、iOS中自定义对象的深浅拷贝"><a href="#3、iOS中自定义对象的深浅拷贝" class="headerlink" title="3、iOS中自定义对象的深浅拷贝"></a>3、iOS中自定义对象的深浅拷贝</h3><p>iOS中自定义对象要想实现拷贝，必须要实现<code>NSCopying</code>或者<code>NSMutableCopying</code>协议。<br>自定义对象实现拷贝示例代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cat.h</span></span><br><span class="line"># <span class="keyword">import</span> &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface <span class="type">Cat</span> : <span class="type">NSObject</span> &lt;<span class="type">NSCopying</span>, <span class="type">NSMutableCopying</span>&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) <span class="type">NSUInteger</span> age;</span><br><span class="line">@property (nonatomic, copy) <span class="type">NSString</span> *name;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cat.m</span></span><br><span class="line"># <span class="keyword">import</span> "Cat.h"</span><br><span class="line"></span><br><span class="line">@implementation <span class="type">Cat</span></span><br><span class="line"></span><br><span class="line">- (instancetype)copyWithZone:(<span class="type">NSZone</span> *)zone&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)mutableCopyWithZone:(<span class="type">NSZone</span> *)zone&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">Cat</span> *cat = [[<span class="type">Cat</span> alloc] <span class="keyword">init</span>];</span><br><span class="line">	cat.name = @<span class="string">"hello"</span>;</span><br><span class="line">	<span class="keyword">return</span> cat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>从代码可以看出，自定义类要遵守<code>NSCopy</code>协议或者<code>NSMutableCopy</code>协议，拷贝协议的代码由自己来实现，那么自定义类对象执行<code>copy</code>或者<code>mutableCopy</code>所得的结果，无论是指针层面的浅拷贝，还是完全拷贝，都是由自己来决定的。值得注意的是，如果集合里面包含了自定义类对象，那么要用<code>NSKeyedArchiver/NSKeyedUnarchiver</code>实现集合的完全拷贝，则需要自定义类实现<code>NSCoding</code>协议。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithCoder:(<span class="type">NSCoder</span> *)aDecoder&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">self</span> = [<span class="keyword">super</span> <span class="keyword">init</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">self</span> == <span class="literal">nil</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">self</span>.name = [aDecoder decodeObjectForKey:@<span class="string">"name"</span>];</span><br><span class="line">	<span class="comment">// 依次写下想要decode的属性</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)encodeWithCoder:(<span class="type">NSCoder</span> *)aCoder&#123;</span><br><span class="line"></span><br><span class="line">	[aCoder encodeObject:<span class="keyword">self</span>.name forKey:@<span class="string">"name"</span>];</span><br><span class="line">	<span class="comment">// 依次写下想要encode的属性</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>











      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="QSnowy"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">QSnowy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QSnowy</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
